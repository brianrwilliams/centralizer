\documentclass[11pt]{amsart}

\usepackage{macros}
\usepackage[bbgreekl]{mathbbol}

\linespread{1.25}

%\usepackage[final]{pdfpages}

\setcounter{tocdepth}{2}
\numberwithin{equation}{section}



\def\brian{\textcolor{blue}{BW: }\textcolor{blue}}
\def\owen{\textcolor{magenta}{OG: }\textcolor{magenta}}
\def\mahmoud{\textcolor{olive}{MZ: }\textcolor{olive}}
\def\greg{\textcolor{red}{GG: }\textcolor{red}}


\begin{document}
\title{Centralizers of higher enveloping algebras of Lie algebras}

%\author{Owen Gwilliam}
%\address{Department of Mathematics and Statistics \\
%Lederle Graduate Research Tower, 1623D \\
%University of Massachusetts Amherst \\
%710 N. Pleasant Street}
%\email{gwilliam@math.umass.edu}
%
%\author{Brian Williams}
%\address{Department of Mathematics, 
%Northeastern University \\ 
%567 Lake Hall \\ 
%Boston, MA 02115 \\ U.S.A.}
%\email{br.williams@northeastern.edu}


\maketitle
\thispagestyle{empty}




\tableofcontents
 
%Recently, a generalization of the concept of the enveloping algebra of a Lie algebra has emerged: each dg Lie algebra $\fg$ has an enveloping $E_n$ algebra $\UU_n\fg$, for every $n$, so that $\UU_1\fg$ is the usual enveloping algebra $U\fg$. Building on prior work \cite{BD, AF} [Owen's thesis?], Knudsen \cite{Knudsen} developed these ideas extensively and offered a useful factorization algebra model for the enveloping $E_n$ algebra. Our central goal here is to generalize the following results about the enveloping algebra $U\fg$ to $\UU_n\fg$, for all $n$.
%
%\begin{enumerate}
%\item[(1)] the (underived) center of $U\sl_{N+1}$ is isomorphic to $(\Sym(\CC^{N}))^{S_N}$, where $\CC^{N}$ denotes the Cartan subalgebra of $\sl_{N+1}$ and $S_N$ is the Weyl group of $SL_{N+1}$, and
%\item[(2)] the derived center of the enveloping algebra $U\fg$ is given by derived invariants of the adjoint action of $\fg$ on $U\fg$. That is to say $\Hoch^*(U\fg,U\fg) \simeq \clies(\fg, U\fg)$.
%\end{enumerate}
%
%Our results pertains to (1) by taking $N \to \infty$, and to (2) through the derived {\em centralizer} of the map $\UU_n\sl_\infty \hookrightarrow \UU_n\gl_\infty(A)$, where $A$ is a dg algebra. Note that the usual derived center is the centralizer of the identity map $\UU_n\fg \to \UU_n\fg$.
%
%We will review these notions and describe our results in detail Min the next section. When $n=1$,  \owen{state the classical thing here!}
%
%Our primary tool here is the Loday-Quillen-Tsygan (LQT) theorem which describes the large $N$ limit of the Lie algebra homology of $\gl_N(A)$, for a dg associative algebra $A$. Since the enveloping $E_n$ algebra of a Lie algebra can be constructed as a locally constant factorization algebra made out of the shifted Chevalley-Eilenberg chains \cite{}, the relevance of the LQT theorem in this context  should be apparent. From this point of view, one can think of our main result as an $E_n$ generalization of the LQT theorem. We hope these ideas have exciting applications in quantum field theory and random matrix theory, as well as to other large $N$ limit phenomena.

\begin{rmk}
Throughout this document, we will work with differential graded vector spaces over a field $k$ of characteristic zero. We refer to dg Lie algebras simply as Lie algebra, and refer to those without grading and a differential, such as $\sl_2(\CC)$, as ordinary Lie algebras. Similarly, the term algebra means dg algebra unless stated otherwise.
\end{rmk}

\begin{rmk}
We state our theorems in terms of the stable $\infty$-category of cochain complexes 
instead of the stable model categories or pre-triangulated dg categories. 
Many of our constructions, however, involve explicit manipulations of standard complexes, 
and when it is helpful, we indicate the level at which we are working.
\end{rmk}

\owen{We should collect here a list of notations, such as}

Let $\Ch_k^{\otimes_k}$ be the symmetric monoidal stable $\infty$-category arising from cochain complexes of vector spaces over a characteristic zero field $k$.
Let ${\tt Ch}_k^{\otimes_k}$ denote the symmetric monoidal stable model category of cochain complexes of vector spaces over a characteristic zero field $k$ ETC.

\greg{need to add a notation/convention somewhere including that $\Sigma^n$ will be shift functor, convention for grading and so on}

\section{Our main results}

See section~\ref{sec: en background} for a brief discussion of $E_n$ algebras and their relationship with locally constant factorization algebras on $\RR^n$, section~\ref{sec: enveloping} for a brief discussion of the enveloping $E_n$ algebra construction, and see section~\ref{sec: centralizer} 
for a brief discussion about centralizers to maps of $E_n$ algebras.

\subsection{The central theorem and its proof strategy}

%\owen{An approximate version of our main theorem. It's not terrible but I'd like to make the statement more accurate and perhaps punchier.}

Even to state our central result, we need to review a few results and terminology.
First, our basic context is $E_n$ algebras.
By $E_n$ we mean any operad or colored operad or $\infty$-operad equivalent to the topological operad of little $n$-disks in $\RR^n$, where the notion of equivalence is in some appropriate $\infty$-categorical setting of operads. 
In particular, we will require that its $\infty$-category of algebras in $\Ch_k^{\otimes_k}$ agree with those of the little $n$-disks operad. 
For us the preferred presentation is by locally constant factorization algebras on $\RR^n$,
which, as we explain below, can be understood via a colored operad whose colors are open sets in~$\RR^n$.

Our approach here relies on a concrete and convenient model for these enveloping $E_n$ algebras by factorization algebras.
In particular, thanks to Knudsen \cite{Knudsen}, 
we know that the $E_n$ enveloping algebra $\UU_n \fg$ admits a model $\bU_n \fg$ whose underlying functor on the poset of open sets in $\RR^n$ assigns $\cliels(\Omega_c^*(V) \otimes \fg)$ to each open set~$V$.
There is another factorization algebra whose underlying assigns $\clies(\Omega^*(V) \otimes \fg)$ to each open~$V$.
Our paper shows that such factorization algebras model other important $E_n$ algebras, notably centralizers.

\begin{thm}
\label{thm: centralizer}
Let $\fg$ and $\fh$ be $L_\infty$ algebras over the real or complex numbers, 
and let $f: \fg \rightsquigarrow \fh$ be a homotopy-coherent morphism of $L_\infty$ algebras
(i.e., a map of conilpotent cocommutative coalgebras $f: \cliels(\fg) \to \cliels(\fh)$).
This map determines functorially a map of $E_n$ algebras
\[
\UU_n f: \UU_n \fg \to \UU_n \fh
\]
between their enveloping $E_n$ algebras.
The centralizer of this map ${\frak Z}_{E_n}(\UU_n f)$ is an $E_n$-algebra modeled by the factorization algebra 
\[
\clies(\Omega^* \otimes \fg, \cliels(\Omega^*_c \otimes \fh)_f)
\]
equipped with a convolution-type product,
where the subscript $f$ indicates how $\cliels(\Omega^*_c \otimes \fh)$ is a module over $\Omega^* \otimes \fg$.
\end{thm}

\owen{I think we could (and maybe should) also discuss the $E_n$-Koszul dual situation involving cochains.}

\def\Disk{{\rm Disk}}

Our proof involves explicit manipulations with cochain complexes and the poset of opens in~$\RR^n$.
To connect that setting with the abstract $\infty$-categorical setting above,
we leverage deep, prior work:
\begin{itemize}
\item Lurie \cite{LurieHA} explains why the $\infty$-category of $E_n$ algebras is equivalent to the homotopy-coherent version of locally constant prefactorization algebras on $\RR^n$.  
In fact, he simplifies the situation a bit more. 
Let $\Disk_n^\sqcup$ denote the colored operad whose colors are balls in $\RR^n$ and whose spaces of operations are either empty or a point, depending on whether the input balls are pairwise disjoint and subsets of the output ball. 
One can work with locally constant, homotopy-coherent $\Disk_n^\sqcup$-algebras.
\item Knudsen verifies that we can model the enveloping $E_n$ algebra by the factorization algebra $\bU_n \fg$ described earlier.
\item Lurie and Francis give a characterization of the centralizer ${\frak Z}_{E_n}(f)$ of any $E_n$ algebra map $\phi: A \to B$ as the ``internal hom'' in left $\int_{S^{n-1}}A$-modules from $A$ to $B_\phi$, where $B_\phi$ denotes $B$ viewed as a left module via the map~$\phi$.
\item In combination, the centralizer is characterized up to quasi-isomorphism, 
since it is easy to compute the factorization homology of the enveloping algebra $\UU_n \fg$ over a sphere.
\end{itemize}
In \S2 we review these results in more detail with an emphasis on what we need for our central theorem.

Here is an outline of our proof:
\begin{enumerate}
\item Let ${\bf f}: \cliels(\Omega_c^* \otimes \fg) \to \cliels(\Omega_c^* \otimes \fh)$ denote a map of factorization algebras that models with map $\UU_n f$ between enveloping algebras. 
We use it to produce an explicit factorization algebra $\clies(\Omega \otimes \fg, \cliels(\Omega_c^* \otimes \fh)_f)$ as a kind of ``convolution factorization algebra.'' 
\item We show this object fits canonically into a centralizer diagram: there is a map of factorization algebras
\[
\clies(\Omega \otimes \fg, \cliels(\Omega_c^* \otimes \fh)_f) \otimes \bU_n \fg \to \cliels(\Omega_c^* \otimes \fh)
\]
such that precomposing with the map $1 \otimes \id_{\UU_n \fg}$ is the map~${\bf f}$.
Fitting into such a diagram guarantees a canonical map 
\[
\clies(\Omega \otimes \fg, \cliels(\Omega_c^* \otimes \fh)_f) \to \bZ({\bf f})
\]
as factorization algebras. 
\item We then verify that this map is a quasi-isomorphism on disks, by the Lurie-Francis result mentioned above. 
\end{enumerate}
Hence it induces a weak equivalence of the associated factorization algebras and hence as $E_n$ algebras. 

\subsection{Consequences of the central result}

If $\rho: \fg \to \fg$ is the identity map, we get the following immediate corollary.

\begin{cor}
\label{thm: center}
The center of the enveloping $E_n$ algebra $\UU_n\fg$ is the $E_n$ algebra $\clies(\fg, \UU_n\fg)$. 
When $k$ is $\RR$ or $\CC$, the 
center is modeled by the locally constant factorization algebra that assigns
\[
\clies(\fg \otimes \Omega^*(U), \cliels( \fg \otimes \Omega^*_c(U)))
\]
to each open set $U \subset \RR^n$.
\end{cor}

This result generalizes the fact that $\Hoch^*(U\fg,U\fg) \simeq \clies(\fg, U\fg)$, 
since the associative algebra $U\fg$ is modeled by the locally constant one-dimensional factorization algebra that assigns
$\cliels (\fg \otimes \Omega^*_c(U))$ to each open $U \subset \RR$. 

\owen{Add remark that by Dunn's additivity theorem, the center has a natural $E_{n+1}$ algebra structure.}
\greg{I will add stuff and rewrite that later, hopefully to explain ``how'' to see the $E_{n+1}$-structure}

\greg{We could relate this to $P_n$-center of $\fg$. That shall also (but I have to think about the proof more), 
at least up to formality gives the $P_{n+1}$-structure on it. }

If $\epsilon: \fg \to 0$ is the trivial map, then we obtain the canonical augmentation $\epsilon: \UU_n \fg \to k$ of $E_n$ algebras.
In this case, we obtain a version of Koszul duality as the corollary.

\begin{cor}
\label{thm: koszul duality}
The centralizer of the augmentation $\epsilon: \UU_n \fg \to k$ is equivalent to $\clies(\fg)$ viewed as an $E_n$ algebra. It is modeled by the locally constant factorization algebra that assigns
\[
\clies(\fg \otimes \Omega^*(V))
\]
to each open set $V \subset \RR^n$.
\end{cor}

\owen{Some easy but important situations to examine:}
\begin{itemize}
\item When $n=0$, we see naive endomorphisms arise.
\item When $n=1$, we recover standard Koszul duality and Hochschild cohomology examples.
\item When $n=1$, unpack in detail how the convolution picture matches the classic view of Koszul duality for associative (co)algebras.
\item Consider $\fg$ {\em abelian} for arbitrary $n$ and compare to the $E_n$ HKR theorem.
\item Compare with $E_n$ HKR theorem for $\clies(\fg)$ via $E_n$ Koszul duality.
\item Use these facts to compute factorization homology of centralizers on manifolds with boundary --- kind of like Chern-Simons states!
\end{itemize}

Having an explicit presentation for the centralizer of a map of $E_n$ algebras leads to a calculation of factorization homology.
The enveloping $E_n$ algebra is the homotopy $O(n)$-fixed points, or a $\mathrm{Disk}_n$-algebra in the sense of~\cite{AF},
and hence determines a factorization algebra on any un-oriented $n$-dimensional manifold \cite{Knudsen}.
Therefore, for a closed $n$-dimensional manifold $M$, one has
\[
\int_M {\frak Z}_{E_n}(\UU_n \rho) \simeq \clies(\fg \otimes \Omega^*(M), \cliels( \fh \otimes \Omega^*(M))).
\]
Since $\Omega^*(S^n) \simeq \CC[\epsilon_n]$, where $\epsilon_n$ is a formal variable with $|\epsilon_n| = n$ and $\epsilon_n^2 = 0$, we have
\[
\int_{S^n} {\frak Z}_{E_n}(\UU_n \rho) \simeq \clies(\fg[\epsilon_n], \cliels( \fh[\epsilon_n]))
\]
For $n=1$, this recovers a theorem of Tamarkin and Tsygan \cite{TT} on the Hochschild cohomology of differential operators on a Lie group $G$;
see Example~\ref{eg: TT}. 

\greg{Somewhere we should recall that $\UU_n$ and its center are unoriented $E_n$-algebras and define factorization algebras over any manifold that came from the formula}

\subsection{Comments on a generalization}

\owen{I think we can conjecture here the general statement that we almost proved and sketch an approach.}

\section{Background}

\owen{Add overview}

\subsection{Recollections on $E_n$ algebras and prefactorization algebras}
\label{sec: en background}

\owen{Recall Jacob's results and what it means in conjunction with strictification.}

\owen{I want to work with a colored operad $\Disk_n$ of round disks (or rectilinear boxes) in $\RR^n$.}

\owen{Recall any relevant strictification results.}

Note that in the theorem we use the following equivalence due to Lurie~\cite{LurieHA}. 

\begin{thm}
\label{T:En=Fac} 
There is an equivalence of $\infty$-categories between $E_n$-algebras and locally constant prefactorization algebras on~$\RR^n$. 
\end{thm}

\owen{Plus a version for $\Disk_n$ algebras}

\subsection{Enveloping $E_n$ algebras of Lie algebras}
\label{sec: enveloping}

Although \cite{Knudsen} develops an adjunction between Lie and $E_n$ algebras \mahmoud{non-unital?}\greg{Both I think}\owen{augmented is probably best for us}
in any presentable symmetric monoidal stable $\infty$-category $\cC$,
we only work in the infinity category of chain complexes $(\Mod_k, \otimes_k)$, where $k$ is a field of characteristic zero.
We summarize Knudsen's result in this setting as follows.

\begin{thm}\label{T:UnofLie}
There is a commuting square of adjunctions
\[
\begin{tikzcd}
\Alg_\Lie(\Mod_k) \arrow[r, bend left=20, shift left=.5ex,"\UU_n"] \arrow[dd] & \Alg_{E_n}(\Mod_k) \arrow[l, shift left=.5ex, "\oblv_n"] \arrow[dd]\\
&\\
\Mod_k \arrow[r, bend left=20, shift left=.5ex, "\Sigma^{1-n}"] \arrow[uu, bend left=20, shift left=.5ex, "\Free_\Lie"] & \Mod_k \arrow[l, shift left=.5ex,"\Sigma^{n-1}"] \arrow[uu, bend right=20, shift right=.5ex, "\Free_{E_n}"']
\end{tikzcd}
\]
\greg{Also explains what commutatrive means here ? Meaning the curved arrow diagram and the straight arrow diagram only; not combos of such}
\mahmoud{explain what oblv stands for}
where $\Sigma$ denotes suspension \owen{because tikzcd does weird things with ``[1-n]'' instead}, \mahmoud{earlier we denoted the shift by [n]. should we use $\Sigma^n$ everywhere?}.
(Curving arrows denote left adjoints.)

When $k$ is $\RR$ or $\CC$, 
the enveloping $E_n$ algebra $\UU_n \fg$ of a dg Lie algebra $\fg$ is modeled by the locally constant factorization algebra $\bU_n \fg$ that assigns
\[
\bU_n \fg(V) = \cliels(\Omega^*_c(V) \otimes \fg)
\]
to each open set $V \subset \RR^n$.
\end{thm}

The second part of this result leads to the explicit models in our theorems.

\owen{Add discussion of how this makes sense even on unoriented manifolds.}

In fact, Knudsen shows a stronger version of the second part.
if one restricts to working with open balls in $\RR^n$ (rather than arbitrary open sets)
then there is a $\Disk_n$-algebra ${\tt U}_n \fg$ assigning $\cliels(\fg[-n]) = \Sym(\fg[1-n])$ to each ball and it is manifestly locally constant.
This algebra ${\tt U}_n \fg$ is a model for~$\UU_n \fg$.

\begin{rmk}
It follows from theorem~\ref{T:UnofLie} that for any $E_n$-algebra $B$, 
its underlying complex is equipped with a homotopy-coherent Lie algebra structure.
Depending on one's preferences, one can work with an an $L_\infty$-algebra structure or strictify to a dg Lie algebra structure (at the cost of replacing the complex with something quasi-isomorphic but typically much larger).
\end{rmk}

\subsection{Centralizers of maps of $E_n$ algebras and the derived center}
\label{sec: centralizer}

We briefly review some of the main notions and refer the reader to \cite{LurieHA} Section 5.3 and \cite{FrancisHH} for detailed discussions. Let $\cC^\otimes$ denote a presentable stable symmetric monoidal $\infty$-category (for us, chain complexes over a field $k$ of characteristic zero with~$\otimes_k$).

\begin{dfn}\label{D:centralizer}
For a map $f: A \to B$ of $E_n$ algebras in $\cC$, 
the {\em centralizer} ${\frak Z}_{E_n}(f)$ is the $E_n$ algebra in $\cC$ that is universal among those that fit in a commuting diagram
\[
\begin{tikzcd}
& {\frak Z}_{E_n}(f) \otimes A \arrow[dr] & \\
A \arrow[ur, "u \otimes \id"] \arrow[rr, "f"] && B
\end{tikzcd}
\]
where the arrow in the upper left is the tensor product of the unit map $u: 1_\cC \to {\frak Z}_{E_n}(f)$ and the identity map $\id: A \to A$.
The {\em center} of an $E_n$ algebra $A$ is the centralizer of its identity morphism $\id_A: A \to A$. 
We  denote it ${\frak Z}_{E_n}(A) := {\frak Z}_{E_n}(\id_A)$.
\end{dfn}

When $n=1$ and $\cC$ is the category of vector spaces, 
the centralizer of $f: A \to B$ consists of elements in $B$ that commute with the image $f(A)$ inside~$B$. 
In particular, taking $f$ as the identity map, 
the center of $A$ defined above agrees with the traditional notion. 
See Theorem 5.3.1.30 of~\cite{LurieHA}, or Proposition 6.22 in~\cite{GTZ3}, for an alternative characterization.

\begin{prp}
\label{T:centralizer=inthom} 
The centralizer ${\frak Z}_{E_n}(f)$ exists and can be identified with the classifying object for maps from $A$ to $B$ in the $\infty$-category $\Mod^{E_n}_A(\cC)$. \mahmoud{we should probably spell out the meaning of the classifying object in this case to make it obvious that the centralizer is the classifying object}
\end{prp} 

When $n=1$ and $\cC$ is chain complexes over the field $k$, then $\Mod^{E_1}_A(\cC)$ is equivalent to $A\otimes A^{op}$-modules and hence ${\frak Z}_{E_1}(f) \simeq {\rm Hoch}^*(A,B_f)$,
where $B_f$ denotes $B$ viewed as an $A\otimes A^{op}$-modules via the map~$f$.

We record a key fact drawn from \cite{LurieHA},~\cite{FrancisHH}  and \cite{GG-Notes}, which generalizes this situation.

\begin{prp}
\label{P:ModentoModSn}
Let $\cC^\otimes$ be a presentable symmetric monoidal stable $\infty$-category whose tensor product preserves colimits in each variable separately.
For $A$ be an $E_n$ algebra in $\cC$,
the $\infty$-category $\Mod^{E_n}_A(\cC)$ is equivalent to the $\infty$-category $\LMod_{\int_{S^{n-1} A}}(\cC)$.
\end{prp}

See Remark 7.3.5.3 of \cite{LurieHA}, Corollary 13 in~\cite{GG-Notes} and Section 2 of \cite{FrancisHH}.
Concretely, this claim arises from the fact that as a module over $A$ as an $E_n$ algebra, 
$M \in \Mod^{E_n}_A(\cC)$ is equipped with a commuting family of actions by $A$ parametrized by $\RR^n \setminus \{0\}\cong S^{n-1} \times \RR_{>0}$.
This action factors through the left action of the $E_1$ algebra $\int_{S^{n-1} \times \RR_{>0}} A$ arising from factorization homology over the complement of the origin,
which integrates all those actions and through which they all factor. 
As shown in Theorem 7.5.3.1 of \cite{LurieHA} and earlier in Proposition 3.16 of \cite{FrancisHH}, 
this algebra $\int_{S^{n-1} \times \RR} A$ is equivalent to ${\rm Free}(1_\cC)$, 
the image of the unit object $1_\cC \in \cC$ under the left adjoint ${\rm Free}$ to the forgetful functor $\Mod^{E_n}_A(\cC) \to \cC$.

We now turn to proving Theorem~\ref{thm: centralizer}.

\section{Proof of Theorem \ref{thm: centralizer}}

Recall the overall strategy.
First, we define a factorization algebra $\clies(\Omega^* \otimes \fg, (\bU_n \fh)_f)$ as a kind of convolution factorization algebra.
Then we get to the heart of the construction:
we show that this convolution algebra naturally sits inside a centralizer diagram.
By the universal property of the centralizer, we then obtain 
a canonical map 
\[
\theta_{{\bf f}}: \clies\big(\fg\otimes \Omega , B \big) \longrightarrow  \bZ(\mathbf{f})
\]
where $\bZ(\mathbf{f})$ is some locally constant factorization algebra that models the centralizer ${\frak Z}(f)$ of the map $f$.
It is then a direct computation to verify $\theta_f$ is a quasi-isomorphism,
using the Francis-Lurie result mentioned earlier.

\owen{Comment on notations:}
As we work in the setting of factorization algebras on $\RR^n$, 
we will use bold font to indicate such factorization models for $E_n$ algebra statements.
For instance, we use $\bU_n \fg$ for the factorization model of the enveloping $E_n$ algebra,
and we use ${\bf f}: \bU_n \fg \to \bU_n \fh$ for the factorization model of the map $f: \UU_n \fg \to \UU_n \fh$ of $E_n$ algebras.

\subsection{Standard manipulations with $L_\infty$ algebras and their modules}

\owen{Please read and comment if it is too fast or cryptic (or wrong due, e.g., to sloppy shifts).}

We assume the reader is familiar with Lie algebras and $L_\infty$ algebras and with standard constructions,
such as the Chevalley-Eilenberg chains or cochains, which we may also call the Lie algebra (co)chains.
A nice reference is \owen{Loday-Vallette???}
Nonetheless, we review a few aspects that play a crucial role below.

First, recall that an $L_\infty$ algebra $\fg$, with its collection of brackets $\{\ell_n\}_{n \geq 1}$ is fully encoded by its dg conilpotent cocommutative coalgebra
\[
\cliels(\fg) = \bigg(\Sym(\fg[1]) \; , \; \d = \sum_{n \geq 1} \ell_n\bigg)
\]
where the sum of the brackets provides a square-zero coderivation.
The square-zero condition efficiently encodes the higher Jacobi relations.
This coalgebra is canonically coaugmented by the inclusion of the base field $k \xto{\simeq} \Sym^0(\fg[1])$.
Let $\overline{\cliels(\fg)} \subset \cliels(\fg)$ denote the subcoalgebra given by the direct sum over positive symmetric powers of $\fg[1]$,
which can be identified with both the kernel of the counit map as well as cokernel of the coaugmentation map.

By definition, an $L_\infty$ map $f: \fg \rightsquigarrow \fh$ is a (strict) map of such dg cocommutative coalgebras
\[
f: \cliels(\fg) \to \cliels(\fh).
\]
The requirement that $f$ preserves all that structure encodes efficiently that the brackets intertwine in the correct fashion.
It is then immediate that the hom-complex
\[
\Hom^\bullet (\cliels(\fg), \cliels(\fh))
\]
admits a deformed differential
\[
\d_\Hom + [f,-]
\]
known as a twisting cocycle.
We use 
\[
\clies(\fg,\cliels(\fh)_f)
\]
to denote this cochain complex whose differential depends on the choice of $L_\infty$ map~$f$,
and we call it the {\em Lie algebra cochains of $\fg$ with values in $\fh$ arising from the map~$f$}.

This complex $\clies(\fg,\cliels(\fh)_f)$ encodes the deformation theory for $L_\infty$ maps around the map $f$.
That is, in a sufficiently sophisticated geometric setting, it is the tangent complex to the mapping space of $L_\infty$ maps from $\fg$ to~$\fh$.
One should view $f$ as the basepoint for this tangent complex.
Due to the splitting
\[
\cliels(\fg) = k \oplus \overline{\cliels(\fg)},
\]
we have a decomposition
\[
\clies(\fg,\cliels(\fh)_f) \cong \cliels(\fh) \oplus \Hom^\bullet(\overline{\cliels(\fg)}, \cliels(\fh)_f),
\]
which plays a crucial role in our argument.

Indeed, consider the canonical evaluation pairing
\[
\ev_{f}: \clies(\fg,\cliels(\fh)_f) \otimes \cliels(\fg) \to \cliels(\fh)
\]
sending $(1 + g, x)$ to $f(x) + g(x)$, where $g \in \Hom^\bullet(\overline{\cliels(\fg)}, \cliels(\fh)_f)$.
In this sense, we see how the Lie algebra cochains arising from $f$ encodes deformations.

\subsection{Defining the convolution factorization algebra}

Our goal here is to construct the factorization algebra that models the centralizer.
First, we need to show that there is a well-defined functor (in the 1-categorical sense) ${\rm Opens}_{\RR^n} \to \Ch_k$ assigning $\clies(\Omega^*(V) \otimes \fg, \bU_n \fh(V))$ to each open set $V$.
Once that is in place, it is straightforward to describe the structure maps of the prefactorization algebra and to verify it forms a factorization algebra.

\begin{rmk}
These arguments are now standard in the literature of factorization algebras, so we will be brief in our discussion.
See, e.g., \cite{CG1} \owen{stuff by Greg and others} for more.
\end{rmk}

Consider now a fixed open set $V \subset \RR^n$.
Then the $L_\infty$ map $f: \fg \rightsquigarrow \fh$ induces canonically an $L_\infty$ map 
\[
\tilde{f}: \Omega^*_c(V) \otimes \fg \rightsquigarrow \Omega^*_c(V) \otimes \fh
\]
by base change along the map $k \to \Omega^*_c(V)$ of dg commutative algebras,
as the compactly supported de Rham forms form a dg commutative algebra under wedge product.
In consequence, we see that $\Omega^*_c(V) \otimes \fg$ acts on $\Omega^*_c(V) \otimes \fh$ and hence equips it with the structure of an $L_\infty$ module over $\Omega^*_c(V) \otimes \fg$.
We denote this module as
\[
(\Omega^*_c(V) \otimes \fh)_f
\]
to emphasize the dependence on the original map~$f$.
In this action, the wedge product of forms intertwines with the $L_\infty$ structure on $\fg$ in a very simple way: 
they simply happen side by side, but do not affect each other.

Observe that $\Omega^*_c(V)$ is a module over the dg commutative algebra $\Omega^*(V)$ of {\em non}\/compactly supported forms.
This action extends immediately to the module $(\Omega^*_c(V) \otimes \fh)_f$, 
so we now view it as an $L_\infty$ module over $\Omega^*(V) \otimes \fg$ as well.
We now need to explain how to make $\cliels(\Omega^*_c(V) \otimes \fh)$ into an $L_\infty$-module over $\Omega^*(V) \otimes \fg$.
Here we rely on the fact that modules over an $L_\infty$ algebra are symmetric monoidal over $\otimes_k$, 
so that we can construct new modules from a given module by taking symmetric powers.
Since
\[
\cliels(\Omega^*_c(V) \otimes \fh) = \bigoplus_{n \geq 0} \Sym^n(\Omega^*_c(V) \otimes \fh[1])
\]
as cochain complexes,
we see that $\cliels(\Omega^*_c(V) \otimes \fh)$ acquires a canonical action of $\Omega^*(V) \otimes \fg$.
In consequence, we have a cochain complex
\[
\clies(\Omega^*(V) \otimes \fg, \cliels(\Omega^*_c(V) \otimes \fh)_f)
\]
on each open set~$V$.

The next step is to verify functoriality of this construction over the poset of opens.
This property follows quickly from the fact that wedge product of forms preserves support.
Given an inclusion $i: V' \subset V$ of opens, if we take a form $\alpha \in \Omega^*(V)$ and a compactly supported form $\beta \in \Omega^*_c(V')$, then the wedge product $\alpha \wedge i_* \beta \in \Omega^*_c(V)$ after applying the extension-by-zero map $i_*: \Omega^*_c(V') \to \Omega^*_c(V)$ equals the wedge product $i_*(i^*\alpha \wedge \beta)$ arising from the restriction $i^* \alpha$ of $\alpha$ to~$V'$.
In consequence, the action of $\Omega^*(V) \otimes \fg$ on $\cliels(\Omega^*_c(V') \otimes \fh)_f$ arising from the restriction map $\Omega^*(V) \otimes \fg \to \Omega^*(V') \otimes \fg$ of $L_\infty$ algebras agrees with action induced by the inclusion of $\cliels(\Omega^*_c(V') \otimes \fh)_f$ as a (strict) submodule of~$\cliels(\Omega^*_c(V) \otimes \fh)_f$.
This argument is manifestly associative under composition of inclusions, so we have shown our first claim.

\begin{lmm}
The assignment
\[
V \mapsto \clies(\Omega^*(V) \otimes \fg, \cliels(\Omega^*_c(V) \otimes \fh)_f)
\]
determines a functor from ${\rm Opens}_{\RR^n}$ to~$\Ch_k$.
\end{lmm}

We now turn to extending this functor to an algebra over the colored operad ${\rm Opens}_{\RR^n}^\sqcup$ whose colors are opens in $\RR^n$ where there is a precisely a single operation from a tuple of opens $[V_1,\ldots,V_k]$ to an open $W$ if and only if both $W$ contains every $V_j$ and the $V_j$ are all pairwise disjoint.

The key fact is that the functors $\cliels$ and $\clies$ are suitably symmetric monoidal:
they send a product of $L_\infty$ algebras to a tensor product of cochain complexes.
Hence it suffices to examine the underlying functors to $L_\infty$ algebras.
As the functors $\Omega^*$ and $\Omega^*_c$ send finite disjoint unions of opens to the direct product of cochain complexes, 
the functors like $\Omega^* \otimes \fg$ and $\Omega^*_c \otimes \fh$ send finite disjoint unions of opens to products of $L_\infty$ algebras.
In consequence, we obtain the desired second claim.

\begin{lmm}
The assignment
\[
V \mapsto \clies(\Omega^*(V) \otimes \fg, \cliels(\Omega^*_c(V) \otimes \fh)_f)
\]
determines a prefactorization algebra, i.e., a strict algebra over ${\rm Opens}_{\RR^n}^\sqcup$ with values in~$\Ch_k^\otimes$.
\end{lmm}

Due to the Poincar\'e lemma, the inclusion of a disk into a bigger disk $D \hookrightarrow D'$ makes the structure map 
\[
\clies(\Omega^*(D) \otimes \fg, \cliels(\Omega^*_c(D) \otimes \fh)_f) \xto{\simeq} \clies(\Omega^*(D) \otimes \fg, \cliels(\Omega^*_c(D) \otimes \fh)_f)
\]
a quasi-isomorphism.
Hence this prefactorization algebra is locally constant in a homotopical sense.

In fact, it defines a {\em factorization} algebra, by arguments that can be found in \owen{chapter 6 of \cite{CG1} and elsewhere}.

\begin{dfn}
\label{dfn: centralizer for f}
Let $\clies(\Omega^* \otimes \fg, (\bU_n \fh)_f)$ denote this factorization algebra on $\RR^n$ arising from the map $f: \fg \rightsquigarrow \fh$.
\end{dfn}

\begin{rmk}
For those coming from an operadic background, it may be helpful to recognize that our approach is a variant of a familiar convolution construction.
The functor $\bU_n \fh = \cliels(\Omega^*_c \otimes \fh)$ determines an algebra over the colored operad ${\rm Opens}_{\RR^n}^\sqcup$,
while the functor $\cliels(\Omega^* \otimes \fg)$ determines a {\em co}\/algebra over the colored operad ${\rm Opens}_{\RR^n}^\sqcup$.
The algebra $\clies(\Omega^* \otimes \fg, (\bU_n \fh)_f)$ assigns the graded vector space
\[
\Hom^\bullet(\cliels(\Omega^*(V) \otimes \fg), \cliels(\Omega^*_c(V) \otimes \fh))
\] 
to each open set $V$,
twining together this coalgebra and algebra.
\owen{This has a name, but I'm blanking at the moment.}
The differential can be seen as a twisting cocycle arising from a choice of map $f$;
there is a natural basepoint to the space of differentials on this graded vector space by taking the usual differential of a hom-complex.
\end{rmk}

%
%\def\conv{{\rm Conv}}
%
%\owen{For an ordinary colored operad $\cO$, describe how to produce a $\cO$-algebra $\conv(C,A)$ from any $\cO$-coalgebra $C$ and $\cO$-algebra $A$.}
%
%\owen{A special case to consider is how a cocycle $f \in \conv(C,A)$ encodes an $\cO$-algebra morphism $C^! \to A$ from $C^! = \conv(C,1)$, the ``Koszul dual'' $\cO$-algebra to the coalgebra $C$. This cocycle can be used to twist the differential of $\conv(C,A)$. Hopefully this admits an obvious deformation-theoretic interpretation.}
%
%\owen{If we do this correctly, we might find a model category-theoretic picture of how Koszul duality works for prefactorization algebras.}

\subsection{Construction of the universal pairing in factorization algebras}
\label{SS:constuctionthetaf}

Our goal in this subsection is to construct a map of factorization algebras
\[
\ev_{{\bf f}}: \clies(\Omega^* \otimes \fg, (\Omega^*_c \otimes \fh)_f) \otimes \bU_n \fg \to \bU_n \fh,
\]
while in the next subsection we will show it fits into a centralizer diagram.
To produce our map, we first construct it separately on each open subset and then explain why the construction is functorial. 

Let $V \subset \RR^n$ be open.
The canonical pairing between Lie algebra chains and cochains provides a canonical cochain map
\[
\clies(\Omega^*(V) \otimes \fg, \cliels(\Omega^*_c(V) \otimes \fh)_f) \otimes \cliels(\Omega^*(V) \otimes \fg) \to \cliels(\Omega^*_c(V) \otimes \fh)_f.
\]
The canonical inclusion $\Omega^*_c(V) \otimes \fg \hookrightarrow \Omega^*(V) \otimes \fg$ induces a canonical inclusion 
\[
\cliels(\Omega^*_c(V) \otimes \fg) \hookrightarrow \cliels(\Omega^*(V) \otimes \fg)
\]
and hence, precomposing this inclusion with the pairing, we obtain our desired map
\[
\ev_{{\bf f}}(V): \clies(\Omega^*(V) \otimes \fg, \cliels(\Omega^*_c(V) \otimes \fh)_f) \otimes \bU_n \fg(V) \to \bU_n \fh(V)
\]
for each open~$V$.

This construction is functorial in $V$ because wedge product of differential forms preserves support,
so a minor variation on our argument above implies the following.

\begin{lmm}
The assignment
\[
V \mapsto \ev_{{\bf f}}(V)
\]
determines a natural transformation between functors from ${\rm Opens}_{\RR^n}$ to~$\Ch_k$.
\end{lmm}

\owen{Commented out below is an extensive argument by Greg about the existence and behavior of $\Theta_f$. If my explanation above is missing something crucial, I suspect it's addressed in that argument.}

%\greg{
%We start by defining a pairing between the factorization algebras of Chevalley-Eilenberg (co)chains in order to use the universal property of centralizers.\\
%First note that compactly supported form embeds in all forms, therefore we can apply 
%any element of $\cliels\big(\fg \otimes \Omega^* , B\big)$ 
%to any element of $\cliels\big(\fg \otimes \Omega_c^* \big)$. Therefore, for any  $p\in \bN$, we have an evaluation 
%\begin{equation} \label{eqdef:ev} \begin{array}{c}\ev: Sym^p \big( \fg \otimes \Omega^* (U)[-1] ,B(U)\big)
%\otimes  Sym^p( \fg\otimes \Omega^*_c(U) [1]) \stackrel{ev}\longrightarrow B(U)  
%  \\
% (x,\Phi) \,\longmapsto\, (-1)^{p(|x|+p) } \Phi (x)\end{array}
%\end{equation} induced by this embedding  in all forms followed by evaluating on a function.\\
%Second, the augmentation of $B$ makes $B$ augmented as well (in the obvious sense of~\cite{Gi-NotesFactorization}) and this induces an augmentation on
%$\clies\big(\fg\otimes \Omega , B \big)$ as well as follows. 
%We have the canonical factorization algebra map  $\mathbf{1}$  defined, for any open $U$, by 
%\[\xymatrix{ k(U)=k  \ar[r]^{\quad \cong}& 
%B(\emptyset) \ar[r] & B(U)  } 
% \] where the last map is given by the factorization algebra structure of $B$. This gives the canonical element element 
% $\mathbf{1}\in \clies(\fg\otimes \Omega^*, B) )$ which is the unit $k\to \clies(\fg\otimes \Omega^*, B) )$
% of the factorization structure of 
% the Chevalley-Eilenberg cochain factorization algebras~\ref{dfn:CEofFact}.  
% The augmentation map is given by $\varphi\mapsto \varepsilon \circ \varphi \circ 
% \iota$ where $\iota: k(U) \cong k \hookrightarrow Sym(\fg \otimes \Omega (U) [1]) $ is the inclusion and $\varepsilon B(U)\to k(U)$ is the augmentation of 
% $B$. We therefore obtain a canonical splitting of factorization algebras 
% \begin{equation}\label{eq:splittingbyaugm}
%   \clies\big(\fg\otimes \Omega^*, B\big)  \, \cong \, k \oplus \overline{ \clies(\fg\otimes \Omega^*, B) )}
% \end{equation}
%given by the augmentation. Below~\ref{Rmk:defgraduationclie}, we refine  this splitting, using it  freely  on each-connected component, to obtain 
%a natural grading on it.\\
%We use the splitting and~\eqref{eqdef:ev} to define our pairing as follows. First for a \emph{connected} open subset $W$ of $\RR^n$, we define 
%\begin{multline}\label{eq:defevforconnected}
% \ev_f^W:   \clies (\fg\otimes \Omega (W), B(W)) \otimes \cliels\big(\fg \otimes \Omega_c^* (W)) 
% \\ \cong \, \left( k(W) \oplus \overline{\clies (\fg\otimes \Omega (W), B(W))  }\right) 
% \otimes \cliels\big(\fg \otimes \Omega_c^* (W))  \\ \cong
% \cliels\big(\fg \otimes \Omega_c^* (W))  \oplus  \left(\overline{\clies (\fg\otimes \Omega (W), B(W))  }\otimes \cliels\big(\fg \otimes \Omega_c^* (W)) 
% \right) \\
% \stackrel{ \mathbf{f}\oplus \ev}\longrightarrow  
% B(W)
%\end{multline}
%where $\mathbf{f}$ is the factorization algebra morphism  we are given.
%In other words, if $\varphi = \lambda \mathbf{1} \oplus \overline{\varphi}$ is the decomposition of $\varphi \in  \clies (\fg\otimes \Omega (W), B(W)) $,
%we have 
%\[ \ev_f^W(\varphi\otimes x)= \lambda \mathbf{f}(W)(x) + \overline{\varphi}(x). \]
%We extend this construction  to any 
% open subset in $\RR^n$ using the \lq\lq{}Leibniz rule\rq\rq{}, that is on using it freely on every connected components. 
% More precisely, 
%  write $U=\coprod_{i\in I} U_i$ the decomposition of an open into the  disjoint union 
%of its connected components. Using, the natural isomorphisms of complexes 
%\[Sym\big(\fg \otimes \Omega (U)[-1]\big) 
%\cong \bigotimes\limits_{i\in I} Sym\big(\fg \otimes \Omega ( U_i)[-1]\big), \mbox{  } 
%\bigotimes_{i\in I} \cliels\big(\fg \otimes \Omega_c^* (U_i)\big) \cong
%\cliels\big(\fg \otimes \Omega_c^* (U)\big)\] and
%$\bigotimes_{i\in I} B(U_i) 
%\stackrel{\simeq}\longrightarrow B(U)$, we obtain the 
% (natural) decomposition 
%\begin{multline}\label{eq:defgraduationoncentralizernonconnected}
% \clies\big(\fg\otimes \Omega^*(U), B(U)\big)  \, \cong \, 
% \Hom\left(\bigotimes\limits_{i\in I} Sym\Big(\fg\otimes \Omega (U_i)[-1]), 
% \bigotimes\limits_{i\in I} B(U_i)\right) \\ \cong \, 
% \bigotimes\limits_{i\in I}\left( k(U_i) \oplus \overline{\clies (\fg\otimes \Omega (U_i), B(U_i))  }\right).
%\end{multline}
%and we can therefore define 
%\begin{multline}\label{eq:defineevf}
% \ev_f^U: \clies (\fg\otimes \Omega (U), B(U)) \otimes \cliels\big(\fg \otimes \Omega_c^* (U)) 
% \\ \stackrel{\simeq}\longrightarrow  
%\bigotimes\limits_{i\in I}\left( k(U_i) \oplus \overline{\clies (\fg\otimes \Omega (U_i), B(U_i))  }\right) \otimes 
% \left(\bigotimes\limits_{i\in I}\cliels\big(\fg \otimes \Omega_c^* (U_i)\big)\right)  \\ 
% \stackrel{\bigotimes\limits_{i\in I}\ev^{U_i}_f}\longrightarrow  
% \bigotimes\limits_{i\in I} B(U_i) \stackrel{\mu_B}\longrightarrow B(U)
%\end{multline}
%where $\mu_B$ is the canonical structure map of the factorization algebra $B$ and the other maps are given by~\eqref{eq:defgraduationoncentralizernonconnected} 
%and~\eqref{eq:defevforconnected}.
%\greg{In~\eqref{eq:defgraduationoncentralizernonconnected} and definition of Chevalley Eilneberg complexes, one shall explain/takes care of the appropriate 
%things to do (like completion) for non-finitely dimensional Lie algebras}
%\greg{The decomposition used to extend $\ev$ on non-connected open can be done with any augmented $B$, simply by defining it onto the prefact alg obtained by tensoring 
%out on non-connected components and using the quasi-isomorphism canonical map to $\clies(\fg, B)$ in that case. Not sure which way is easier to define/mention}\\
%\begin{rmk}\label{Rmk:defgraduationclie} The decomposition~\eqref{eq:defgraduationoncentralizernonconnected} makes 
%the Chevalley-Eilenberg cochain complex with value on an open $U$ naturally\footnote{The grading
%is compatible (by the same argument as Lemma~\ref{L:pairingCE}) with the factorization algebra structure maps of
%$\clies(\fg\otimes \Omega, B)$} graded by the subsets of its connected components:
% \begin{equation}\label{eq:defgraduationoncentralizernonconnected2}
% \clies\big(\fg\otimes \Omega^*(U), B(U)\big)  \, \cong \, \bigoplus\limits_{J\subset I} {\clies}^{(J)}\big(\fg\otimes \Omega^*(U), B(U)\big) 
%\end{equation}
%where $J$ runs through all the (possibly empty) subsets of $I$.  Precisely, the $J$-piece is
%\begin{multline*}
%{\clies}^{(J)}\big(\fg\otimes \Omega^*(U), B(U)\big) = 
%\left(\bigotimes\limits_{j\in I\setminus J} k(U_j)\right) \otimes \left(\bigotimes\limits_{j\in J}
%\overline{\clies (\fg\otimes \Omega (U_j), B(U_j))  }\right) \\ \cong 
%\overline{\clies (\fg\otimes \Omega (\coprod\limits_{j\in_J}U_j), B(\coprod\limits_{j\in_J}U_j))  }.
%\end{multline*}
%We think of an element of ${\clies}^{(J)}\big(\fg\otimes \Omega^*(U), B(U)\big)$ has an element of ${\clies}\big(\fg\otimes \Omega^*(U), B(U)\big)$
%\emph{with support $\coprod\limits_{j\in J} U_j$}.   
%Note that the component $k$ in the decomposition~\eqref{eq:splittingbyaugm} is precisely the component 
%${\clies}^{(\emptyset)}\big(\fg\otimes \Omega^*(U), B(U)\big)$ corresponding to the empty family.
%\end{rmk}
%In other words, if $\varphi = \sum_{J\subset I} \varphi^{(J)}$ is the decomposition of $\varphi$ in its graded pieces, for all 
%$X= \bigotimes\limits_{i\in I} X_i \in \bigotimes\limits_{I}\cliels(\fg\otimes \Omega_c^*(U_i)) \cong \cliels(\fg\otimes \Omega^*_c(U))$, we 
%have the following formula generalizing the one for connected open  subsets:
%\begin{equation} \ev_f^U(\varphi\otimes X)= \sum_{J\subset I} \mu_B\left(\mathbf{f}\Big(\bigotimes\limits_{i\in I\setminus J} 
%X_i\Big)\otimes  \varphi^{(J)}\Big(\bigotimes\limits_{j\in J} 
%X_j\Big)\right) \end{equation}
%where $\mu_{B,J}: B\Big(\coprod\limits_{i\in I\setminus J}U_i\Big)\otimes B\Big(\coprod\limits_{j\in J}U_j\Big) \to B(U)$
%is the  structure map of $B$.
%}

We need to show that this natural transformation extends to a morphism of prefactorization algebras,
i.e., that it intertwines with the operations over the colored operad ${\rm Opens}_{\RR^n}^\sqcup$.
Here we use the fact that the evaluation pairing between Lie algebra chains and cochains plays nicely with products of $L_\infty$ algebras, in the following sense.
Let $\fX, \fY$ be $L_\infty$ algebras and let $M, N$ be modules for those respective $L_\infty$ algebras.
The direct sum $M \oplus N$ admits a natural action of the product $L_\infty$ algebra $\fX \times \fY$.
Then the isomorphisms
\begin{align*}
\clies(\fX \times \fY, M \oplus N) \otimes \cliels(\fX \times \fY) 
&\cong (\clies(\fX, M) \otimes \clies(\fY,N) ) \otimes (\cliels(\fX) \otimes \cliels(\fY) ) \\
&\cong (\clies(\fX,M) \otimes \cliels(\fX) ) \otimes (\cliels(\fY,N) \otimes \cliels(\fY) )
\end{align*}
precompose with the tensored evaluation pairings
\[
\cong (\clies(\fX,M) \otimes \cliels(\fX) ) \otimes (\cliels(\fY,N) \otimes \cliels(\fY) ) \xto{\ev_\fX \otimes \ev_\fY} M \otimes N
\]
to provide a canonical map
\[
\clies(\fX \times \fY, M \oplus N) \otimes \cliels(\fX \times \fY) \to M \otimes N.
\]
In light of this observation and the fact that functors such as $\Omega^* \otimes \fg$ and $\Omega^*_c \otimes \fh$ send disjoint unions to products of $L_\infty$ algebras,
we deduce the desired result.

\begin{lmm}
\label{L:pairingCE}
The natural transformation $\ev_{{\bf f}}$ determines a map of strict prefactorization algebras,
i.e., algebras over the colored operad ${\rm Opens}_{\RR^n}^\sqcup$.
\end{lmm}

\subsection{The pairing fits into a centralizer diagram}

For any factorization algebra $B$ on $\RR^n$, 
there is a unit map of factorization algebras  
\[
1(U) = k \cong 1(\emptyset)  \xto{\cong}
B(\emptyset) \to B(V)  
\] 
for each open set $V$, where the last map is structure map of~$B$. 

\begin{lmm}\label{L:ComTriangCent} 
There is a commutative triangle 
\[
\xymatrix{
& \clies ( \Omega \otimes \fg , (\bU_n \fh)_f) \otimes \bU_n \fg
\ar[dr]^{\ev_{{\bf f}}} & \\
\bU_n \fg \ar[ur]^{\mathbf{1} \otimes \id} \ar[rr]^{\mathbf{f}}  & &  \bU_n \fh}
\]
of maps of factorization algebras.
\end{lmm}

\begin{proof}
This triangle commutes on the nose, as we now show.
As a convenience, we will talk about elements, but these are only available if one evaluates a factorization algebra on an open set.
The argument below can be expanded by verifying it holds on an arbitrary open and then by checking that it is functorial in structure maps (which is quickly confirmed).

The map $\mathbf{1} \otimes \id$ sends an element $x$ of $\bU_n \fg$ to $1 \otimes x$,
where $1 \in \clies ( \Omega \otimes \fg , (\bU_n \fh)_f)$ denotes the tensor product of the distinguished element spanning $\Sym^0$ in each tensor factor.
(Remember that both $\clies(\Omega \otimes \fg)$ and $\cliels(\Omega_c \otimes \fh)$ have canonical retracts to the base field $k$.)
Hence we need to show that
\[
\ev_{{\bf f}}(1 \otimes x) = {\bf f}(x).
\]
Here we recall that the evaluation pairing between Lie algebra chains and cochains that arises from an $L_\infty$ map sends the distinguished element $1$ to the map.
\end{proof}

By universal property of the centralizer, 
Lemma~\ref{L:ComTriangCent} implies that the pairing $\ev_{{\bf f}}$ induces a canonical morphism 
\begin{equation}
\label{eq:canonicaltocenter}
\theta_{{\bf f}}: \clies(\fg\otimes \Omega , (\bU_n \fh)_f ) \longrightarrow  {\bZ}(\mathbf{f})
\end{equation}
of factorization algebras.


\subsection{The map $\theta_{{\bf f}}$ is a weak equivalence.} 

We have seen that $\clies(\fg\otimes \Omega , (\bU_n \fh )_f)$ is a locally constant factorization algebra,
and we know the centralizer $\bZ({\bf f})$ is too.
Thus, to show that the map $\theta_{{\bf f}}$ is a weak equivalence (or quasi-isomorphism) of factorization algebras,
it suffices to show it is a quasi-isomorphism when evaluated on open balls.
By local constancy, it is enough just to check on the open set~$\RR^n$ itself.
This we now prove, and hence finish the proof of the central theorem.

\begin{lmm}
\label{L:thetaquisondisk}
The canonical map~\eqref{eq:canonicaltocenter}
\[
\theta_f(D): \clies(\fg\otimes \Omega (D),  (\bU_n \fh)_f) \longrightarrow \bZ(\mathbf{f})(D)
\] 
 is a quasi-isomorphism for any open ball~$D$.
\end{lmm}

\begin{proof}
Recall from Section~\ref{sec: centralizer} that 
\begin{align*}
{\frak Z}_{E_n}(f) &\simeq {{\rm Mor}}_{\Mod^{E_n}_{\UU_n\fg}}(\UU_n \fg, (\UU_n \fh)_f) \\
&\simeq {\rm Mor}_{\LMod_{\int_{S^{n-1}} \UU_n\fg}}(\UU_n \fg, (\UU_n \fh)_f)
\end{align*}
where 
\begin{itemize}
\item[-] $(\UU_n \fh)_f$ denotes the object in $\Mod^{E_n}_{\UU_n\fg}$ --- equivalently, in $\LMod_{\int_{S^{n-1}}\UU_n}$ --- determined by~$f$, 
\item[-] ${\rm Mor}_{\Mod^{E_n}_{\UU_n\fg}}(\UU_n \fg, (\UU_n \fh)_f)$ denotes the classifying object for maps (i.e. an internal mapping object) from $\UU_n\fg$ to $(\UU_n \fh)_f$ in the $\infty$-category $\Mod^{E_n}_{\UU_n\fg}$, and
\item[-] ${\rm Mor}_{\LMod_{\int_{S^{n-1}} \UU_n\fg}} (\UU_n \fg, (\UU_n \fh)_f)$ denotes the classifying object for maps from ${\UU_n\fg}$ to $\UU_n \fh$ in the $\infty$-category $\LMod_{\int_{S^{n-1}}\UU_n\fg}$. 
\end{itemize}
Note that $\int_{S^{n-1}}\UU_n\fg$ is an $E_1$ algebra equivalent to the dg algebra $U(\fg \otimes k[\epsilon_{n-1}])$.
This identification holds because the rational $(n-1)$-sphere is formal, and hence its cochains are quasi-isomorphic to its cohomology $k[\epsilon_{n-1}]$. 
 
Using the canonical inclusion $i: U\fg \to U(\fg \otimes k[\epsilon_{n-1}])$,
we find
\[
k \otimes_{U\fg} U(\fg \otimes k[\epsilon_{n-1}]) \simeq \Sym(\fg[1-n]).
\]
Recall from Section~\ref{sec: enveloping} that $\UU_n \fg$ admits two convenient models:
as a factorization algebra by $\bU_n \fg$ and as a strict algebra over a colored operad $\Disk_n$ assigning $\Sym(\fg[1-n])$ to each disk.
Base change thus gives rise to an equivalence 
\[
{\rm Mor}_{\LMod_{\int_{S^{n-1}} \UU_n}} (\UU_n \fg, (\UU_n \fh)_f)  \simeq {\rm Mor}_{U\fg} (k, (\UU_n \fh)_f)
\]
of underlying cochain complexes, i.e. an equivalence after applying the forgetful functor. 
The right hand side is modeled by Lie algebra cochains of $\fg$ with coefficients in~$(\UU_n \fh)_f$, as desired.
Hence the map $\theta_{\bf f}$ is a quasi-isomorphism on any disk, as needed.
\end{proof}

\section{Functoriality of the centralizer construction}
\label{S:centerinFacAlg}

\owen{If I'm understanding, this section shows that our construction satisfies the ``composition'' of centralizers on the nose. One corollary is that the center has a strict associative product!}

The universal property of centralizer (recall definition~\ref{D:centralizer}) implies that 
for any maps $A\stackrel{f}\to B$ and $B\stackrel{g}\to C$ of $E_n$-algebras, 
there is a natural morphism
\begin{equation}
\label{eqdef:canonicaltocentralizers} 
{\frak Z}_{E_n}(g) \otimes {\frak Z}_{E_n}(f) \longrightarrow {\frak Z}_{E_n}(g\circ f)
\end{equation}
in the $\infty$-category of $E_n$-algebras that arises from  
following commutative diagram of $E_n$-algebras:
\[
\begin{tikzcd}
&   {\frak Z}_{E_n}(g) \otimes  {\frak Z}_{E_n}(f) \otimes A \arrow[rr, "\id\otimes \ev_f"] &&  {\frak Z}_{E_n}(g) \otimes  B \arrow[dr, "\ev_g"]\\
A \arrow[ur, "1\otimes \id_A"] \arrow[rr, "f"] && B \arrow[rr, "g"] \arrow[ur, "1\otimes \id_B"] && C. 
\end{tikzcd}
\]
When $f=g=\id_A:A\to A$, we thus obtain a canonical morphism 
\begin{equation} 
\label{eq:dgAssofcenter}
{\frak Z}_{E_n}(A){\otimes} {\frak Z}_{E_n}(A) \longrightarrow {\frak Z}_{E_n}(A).
\end{equation}
Lurie \cite{HA} has proved that this multiplication makes the center into an $E_1$ algebra in $E_n$-algebras 
and therefore an $E_{n+1}$-algebra, by Dunn additivity. 
%To be precise, there is the following result.
%
%\begin{prp}[\cite{LurieHA} Section 5] 
%\label{P:PtyCenter}
%\begin{itemize}
% \item The canonical map~\eqref{eq:dgAssofcenter} makes the center ${\frak Z}_{E_n}(A)$ into an $E_1$-algebra in the symmetric monoidal category of 
% $E_n$-algebras.
% \item There is a canonical equivalence of the $\infty$-category $E_1\mathrm{-Alg}(E_n\mathrm{-Alg})$ with $E_{n+1}\mathrm{-Alg}$.
%\end{itemize}
%\end{prp}

A compelling aspect of our construction is that it lets one see these properties in a barehanded fashion,
using familiar formulas with $L_\infty$ algebras.
(More accurately, via composition of convolution algebras.)
The goal of this section is to prove directly the following result.

\owen{I'm pooping out, but it should be straightforward to revise this in light of our revisions above.}

\begin{thm}
\label{T:compcentralizer}
 Let $f: \fg \to \fh$ and $g: \fh \to \fl$ be maps of  $L_\infty$-algebras.
\begin{enumerate} 
\item The composition $(-\star-)$ of factorization algebras (definition~\ref{def:comp}) is the canonical map 
\[{\frak Z}_{E_n}(g) \otimes {\frak Z}_{E_n}(f) \longrightarrow {\frak Z}_{E_n}(g\circ f).\] 
\item If $f= \fg \stackrel{\id}\to \fg$,  the composition $(-\star-)$ makes 
$\clies\big(\fg \otimes \Omega, \cliels(\fg \otimes \Omega_c) \big)$ into an 
(augmented) associative algebra object in factorization algebra, with unit given by $\mathbf{1}$, 
which is equivalent to the structure of the center ${\frak Z} (\cliels(\fg \otimes \Omega_c))$. 
\end{enumerate}
\end{thm}

When $A$ is a factorization algebra model for $A$, in virtue of theorem~\ref{T:En=Fac} 
(and \greg{add reference for fac algebra in fac algebra maybe too}), in order to have a factorization algebra 
model of the center of $A$, it is sufficient to describe the induced map 
\[{\frak Z}(A){\otimes} {\frak Z}(A) \longrightarrow {\frak Z}(A)\]
as a factorization algebra homomorphism which makes it an associative object in the category of locally constant factorization algebras.



We now turn to the specific case   of enveloping algebras $\UU_n(\fg)$.

Let $f: \fg \to \fh$, $g: \fh \to \fl$ be  $L_\infty$-algebras morphisms; for instance a dg-Lie algebras morphisms. We write 
\[ \mathbf{f}:\cliels\big(\fg \otimes \Omega^*_c\big) \to  \cliels\big(\fh \otimes \Omega^*_c\big), \quad 
\mathbf{h}:\cliels\big(\fh \otimes \Omega^*_c\big) \to  \cliels\big(\fl \otimes \Omega^*_c\big)\]
for the induced morphisms on their enveloping factorization algebras over $\RR^n$.

The inclusion  of compactly supported forms on all forms induces, for any open $U$,  the  map
\begin{equation}
 \label{eq:incofcpctforms} 
\iota_U: \cliels\big(\fh \otimes \Omega^*_c(U)\big) \, \cong \, 
Sym\big( \fh\otimes  \Omega^*_c (U) [1]\big) \hookrightarrow  
Sym\big( \fh\otimes  \Omega^* (U) [1]\big).
\end{equation}
Recall from section~\ref{SS:constuctionthetaf} that the Chevalley Eilenberg cochain factorization algebras (with values in an augmented factorization 
algebras) 
are canonically pointed  by $\mathbf{1}\in \clies(\fg\otimes \Omega^*, B) )$ which is induced by 
the unit $k\to \clies(\fg\otimes \Omega^*, B) )$
 of the factorization structures.  In particular, we have the canonical splitting~\eqref{eq:splittingbyaugm} 
of the  Chevalley-Eilenberg cochain factorization algebras, and an associated grading~\eqref{eq:defgraduationoncentralizernonconnected2} on each open
set. We denote $\varphi= \lambda_\varphi +\overline{\varphi}$ the induced decomposition given by the splitting~\eqref{eq:splittingbyaugm} . 
We use these gradings as in section~\ref{SS:constuctionthetaf} to construct a composition as follows. 
\begin{dfn}\label{def:comp}
For any \emph{connected} open set $W$, we define  the composition 
$$\clies\big(\fh \otimes \Omega(W), \cliels(\fl \otimes \Omega_c(W)  \big) \otimes 
\clie\big(\fg \otimes \Omega(W), \cliels(\fh \otimes \Omega_c(W)  \big)
\stackrel{(-\star-)}\longrightarrow 
\clies\big(\fg \otimes \Omega(W), \cliels(\fl \otimes \Omega_c(W)  \big)
$$ to be given, for any $$\psi=\lambda_\psi \mathbf{1} +\overline{\psi} \in \clies\big(\fg \otimes \Omega(W), \cliels(\fh \otimes \Omega_c(W)  \big)=
\Hom(Sym\big( \fh\otimes  \Omega (W) [1]\big), Sym\big( \fl\otimes  \Omega_c (W) [1]\big))$$
$$\mbox{and }\varphi =\lambda_\varphi \mathbf{1} +\overline{\varphi}\in \clies\big(\fg \otimes \Omega(W), \cliels(\fh \otimes \Omega_c(W)  \big)= 
\Hom(Sym\big( \fg\otimes  \Omega (W) [1]\big), Sym\big( \fh\otimes  \Omega_c (W) [1]\big)) $$ by 
$$ \psi \star \varphi \, := \, \lambda_{\psi} \lambda_{\varphi} \mathbf{1}+
\lambda_\psi g\circ \overline{\varphi} + \lambda_{\varphi} \overline{\psi} \circ \iota_W \circ f +\overline{\psi} \circ \iota_U \circ \overline{\varphi} . $$
For any open 
$U=\coprod\limits_{i\in I}U_i$, where the $U_i$ are the connected components of $U$,  we define  the composition 
$$\clies\big(\fh \otimes \Omega(U), \cliels(\fl \otimes \Omega_c(U)  \big) \otimes 
\clie\big(\fg \otimes \Omega(U), \cliels(\fh \otimes \Omega_c(U)  \big)
\stackrel{(-\star-)}\longrightarrow 
\clies\big(\fg \otimes \Omega(U), \cliels(\fl \otimes \Omega_c(U)  \big)
$$ as follows. For any $$\psi \in \clies\big(\fg \otimes \Omega(U), \cliels(\fh \otimes \Omega_c(U)  \big)=
\Hom(Sym\big( \fh\otimes  \Omega (U) [1]\big), Sym\big( \fl\otimes  \Omega_c (U) [1]\big))$$
$$\mbox{and }\varphi \in \clies\big(\fg \otimes \Omega(U), \cliels(\fh \otimes \Omega_c(U)  \big)= 
\Hom(Sym\big( \fg\otimes  \Omega (U) [1]\big), Sym\big( \fh\otimes  \Omega_c (U) [1]\big)), $$ we write 
$\varphi = \mathop{\bigotimes}\limits_{i\in I} \varphi_i$, $\psi= \mathop{\bigotimes}\limits_{i\in I} \psi_i$ 
(where $\varphi_i \in \clies\big(\fg \otimes \Omega(U_i), \cliels(\fh \otimes \Omega_c(U_i)  \big)$,
$\psi_i\in \clies\big(\fh \otimes \Omega(U_i), \cliels(\fl \otimes \Omega_c(U_i)  \big)$) 
 using the decomposition~\eqref{eq:defgraduationoncentralizernonconnected}. Then we define
\begin{equation} \label{eqdef:staronnonconnected}
\psi \star \varphi \, := \mu_{\fl} \circ \Big( \bigotimes\limits_{i\in I} (\psi_i \star \varphi_i)\Big) \end{equation}
where $\mu_{\fl}: \mathop{\bigotimes}\limits_{i\in I} \cliels(\fl\otimes \Omega^c(U_I)) \cong \cliels(\fl\otimes \Omega^c(U))$ 
is given by the factorization algebra 
structure. 
\end{dfn}
Since $\iota_U$ is an embeding for every $U$, in the rest of the paper, we will usually 
omit it in the formulas. 

\begin{lmm}\label{L:compisfacmap} The composition $$\clies\big(\fh \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big) \otimes 
\clies\big(\fg \otimes \Omega, \cliels(\fh \otimes \Omega_c  \big)
\stackrel{(-\star-)}\longrightarrow 
\clies\big(\fg \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big)
$$
 is a morphism of factorization algebras.
\end{lmm}
\begin{proof}
 
\end{proof}
The composition is compatible with the augmentation splitting. Precisely, we have
\begin{lmm}\label{L:compisaugmented} For any $\varphi \in \clies\big(\fg \otimes \Omega, \cliels(\fh \otimes \Omega_c  \big)$,
$\psi \in \clies\big(\fh \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big)$
 One has the following equalities  :
 \begin{align}
  \overline{\psi\star \varphi} \;= \;\mathbf{1}\star \overline{\varphi} +\overline{\psi}\star \mathbf{1} +\overline{\psi}\star \overline{\varphi} 
  & \quad\mbox{ (in  $\clies\big(\fg \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big) $)}\\
 \mathbf{1}\star \varphi \;=\;  (\lambda_\varphi \mathbf{1}, g\circ \overline{\varphi})\qquad
  &\quad\mbox{ (in  $k  \oplus \overline{\clies\big(\fg \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big)}$)}\\
  \psi \star \mathbf{1}\;=\; (\lambda_\psi \mathbf{1}, \overline{\psi} \circ f) \qquad
  &\quad\mbox{ (in  $k  \oplus \overline{\clies\big(\fg \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big)}$).}
 \end{align}
 In particular, $\mathbf{1} \star \mathbf{1} =\mathbf{1}$.
\end{lmm}
\greg{maybe I shoudl use the notation $\mathbf{1}_{\mathbf{f}}$, $\mathbf{1}_{\mathbf{g}}$, $\mathbf{1}_{\mathbf{g\circ f}}$ to differentiate 
the various spaces in which leaves the units and avoid possible confusion...?}
\begin{proof}
 
\end{proof}
The composition is asscoiative in the following sense.
\begin{lmm}\label{L:compisassociative} Let $\fg \stackrel{f}\to \fh$, $\fh \stackrel{g}\to \fl$ and $\fl \stackrel{h}\to \fk$ be maps of $L_\infty$-algebras.
 Then, we have, for any $\varphi \in \clies\big(\fg\otimes \Omega, \cliels(\fh \otimes \Omega_c) \big)$, 
  $\psi \in \clies\big(\fh\otimes \Omega, \cliels(\fl \otimes \Omega_c) \big)$ and  
  $\gamma \in \clies\big(\fl\otimes \Omega, \cliels(\fk \otimes \Omega_c) \big)$, the equality 
  \[ (\gamma\star \psi)\star \varphi \;=\; \gamma\star (\psi \star \varphi) \quad \mbox{ in 
  $\clies\big(\fg\otimes \Omega, \cliels(\fk \otimes \Omega_c) \big)$.}  \]
\end{lmm}
\begin{proof}
 
\end{proof}

 
 
\begin{lmm}\label{L:NatPptyofComp}
 The following diagram of factorization algebras 
 \[\tiny \begin{tikzcd}
 \clies\big(\fh \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big) 
 \otimes  \clies\big(\fg \otimes \Omega, \cliels(\fh \otimes \Omega_c  \big) 
 \otimes \cliels(\fg \otimes \Omega_c  \big) \arrow[rd, "(-\star-)\otimes \id"]
 \arrow[dd, "\id\otimes \ev_ {\mathbf{f}}"]& \\ 
 & \clies\big(\fg \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big) 
 \otimes \cliels(\fg \otimes \Omega_c  \big)
 \arrow[dd, "\ev_{\mathbf{g}\circ \mathbf{f}}"]\\
\clies\big(\fh \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big) 
 \otimes \cliels(\fh \otimes \Omega_c  \big)  \arrow[rd, "\ev_{\mathbf{g}}"] & \\  & \cliels(\fl \otimes \Omega_c  \big). 
\end{tikzcd}\]
 is commutative.
\end{lmm}

\begin{proof}
\end{proof}


\begin{proof}[Proof of Theorem~\ref{T:compcentralizer}]
By universal property of centralizers, the canonical map~\eqref{eqdef:canonicaltocentralizers}  
is the unique\footnote{it is unique in the $\infty$-categorical 
sense, that is there is a contractible space of choices for it} map 
\[ \Upsilon: {\frak Z}_{E_n}(\UU_n g) \otimes {\frak Z}_{E_n}(\UU_n f) \longrightarrow {\frak Z}_{E_n}\big(\UU_n (g\circ f)\big)\] 
of $E_n$-algebras which makes the following diagram
\begin{equation}\label{eq:comdiagforcentralizercomput}\small
 \xymatrix{
&   &&  
{\frak Z}_{E_n}\big(\UU_n (g\circ f) \big) \otimes  \UU_n \fg  \ar@/^{2pc}/[dddr]^{\ev_{\UU_n (g\circ f)}}\\
&{\frak Z}_{E_n}(\UU_n g) \otimes  {\frak Z}_{E_n}(\UU_n f) \otimes \UU_n \fg \ar@/^{1pc}/[rru]_{ \Upsilon \otimes \id_{\UU_n \fg}} \ar[rrd]_{\id\otimes \ev_{\UU_n f}}
&& (1)
& & \\
\UU_n \fg \ar[ur]_{1^{\otimes 2}\otimes \id_{\UU_n \fg}} \ar@/_{1pc}/[rrd]^{\UU_n f} \ar@/^{6pc}/[rrruu]_{1\otimes \id_{\UU_n \fg}} &&&
{\frak Z}_{E_n}(\UU_n g) \otimes \UU_n \fh \ar[rd]^{\ev_{\UU_n h}}  &\\
&& \UU_n \fh \ar[rr]^{\UU_n g} \ar[ur]^{1\otimes \id_{\UU_n \fh}} && \UU_n \fl .}
\end{equation}
commutative (since $\UU_n (g\circ f) = \UU_n g\, \circ \, \UU_n f $;  the commutativity of the lower part of the diagram being by definition of centralizers).

By Theorem~\ref{thm:centralizerfactorization}, we know that the factorization algebras models for the centralizers are given by the respective Chevalley-Eilenberg cochain factorizations algebras 
(Definition~\ref{dfn:CEofFact}) $\clies\big(\fg \otimes \Omega, \cliels(\fh \otimes \Omega_c  \big) $, 
$\clies\big(\fh \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big) $ and $\clies\big(\fg \otimes \Omega, \cliels(\fl \otimes \Omega_c  \big) $ 
equipped with the evaluations maps are given by $\ev_{\mathbf{f}}$, $\ev_{\mathbf{g}}$ and $\ev_{\mathbf{g}\circ \mathbf{f}}$. We are thus left 
to prove that the same  diagram as~\eqref{eq:comdiagforcentralizercomput}, where we replace the objects and maps by their factorization analogue and $\Upsilon$
by $(-\star-)$, is commutative in factorization algebras.

Thus the map $(-\star-)$ represents the canonical map of factorization algebras 
$ {\frak Z}(\mathbf{g}) \otimes {\frak Z}(\mathbf{f}) \longrightarrow {\frak Z}(\mathbf{g}\circ \mathbf{f})$ which by proposition~\ref{P:PtyCenter} lifts
into an $E_1$-algebra map. It remains to check that the structure is on the nose an augmented associative algebra structure.
The augmentation and unitality are provided by Lemma~\ref{L:compisaugmented} (since in our case $f=g=\id-A$). 
It remains to prove associativity. It follows from Lemma~\ref{L:compisassociative}. 
The commutativity of the lower square and triangle of the diagram follows from Lemma~\ref{L:ComTriangCent}.
\end{proof}

\greg{To add: remark that it implies the corollary~\ref{thm: center} and so.}

\section{Higher calculus {\it \`a la} Kontsevich and Tamarkin-Tsygan}
\label{sec: TT}

The $E_n$-center, or $E_n$-Hochschild cohomology, of an $E_n$-algebra $A$ is the {\em universal} $E_{n+1}$-algebra that acts on $A$ {\em qua} $E_n$ algebra. 

In Section \ref{sec:swiss} below, we will recall an elegant operadic articulation of this idea and rephrase it in terms of {\em constructible factorization algebras} on a half-space~$\HH^{n+1}$. 

%
%\brian{HKR}
%
%Consider the case $n=1$ and $B = U \fg$ where $f$ is simply the identity map. 
%A classic result of \cite{HochSerre} is that the Hochschild cohomology of $U \fg$ can be expressed in terms of Lie algebra cohomology as $\Hoch^*(U\fg,U\fg) \simeq \clies(\fg, U\fg^{ad})$. 
%On the right-hand side, we take the Chevalley--Eilenberg cochain complex with values in the module $U \fg$ equipped with the adjoint action.
%The algebra structure is given by a special case of the convolution product as in Section \ref{??}. 
%
%On the other hand, our model for the derived center ${\frak Z}(U(\fg))$ of $U \fg$ is the one-dimensional factorization algebra assigning the cochain complex
%\[
%\clies(\fg \otimes \Omega^*(U), \cliels( \fg \otimes \Omega^*_c(U)))
%\]
%to each open set $U \subset \RR$.
%In the case that $U$ is an interval, this cochain complex is quasi-isomorphic to $\clies (\fg , U\fg^{ad})$.
%Furthermore, one can verify that the resulting $E_1$-algebra structure agrees with the one coming from convolution. 
%
%Our model also gives us a simple description of the factorization homology of the derived center along the circle $S^1$.
%\[
%\int_{S^1} {\frak Z}(U(\fg)) \simeq \clies(\fg[\epsilon], \cliels( \fg[\epsilon])),
%\]
%where $\epsilon$ is a formal variable of degree~$1$. 
%\brian{We should compare with Tamarkin-Tsygan's noncommutative calculus (cf. section 2.6).
%We could exhibit Theorem 2.7.1 explicitly in this case for the $E_n$ case with enveloping algebras.}


\subsection{Swiss cheese pairs well with centers}

Given an $E_{n+1}$-algebra one can speak of its $\infty$-category of left (or right) modules.
This $\infty$-category is obtained by ``forgetting" the $E_{n+1}$-algebra to an $E_1$-algebra and then taking the left-modules for this $E_1$-algebra.

The operad of little $n$-disks is built from configurations of disjoint unions of $n$-disks inside $n$-dimensional Euclidean space.
There is a similar operadic picture which encodes $E_{n+1}$-algebras together with their left-modules. 
The idea is too look at configurations of disks and half-disks inside of the upper-half space $\HH^{n+1} = \{(x_1,\ldots, x_{n+1}) \; | \; x_{n+1} \geq 0\}$. 
What results is a two-colored operad known as the $(n+1)$-dimensional Swiss cheese operad where the two colors correspond to disks and half-disks. 


An algebra over this colored operad can be identified with a pair of objects $(B,M)$ where $B$ is an $E_{n+1}$-algebra and $M$ is an $E_n$-algebra in the category of left $B$-modules.
Indeed, if one restricts to the ``disk" colors we recover the data of $B$. 
The operadic structure maps which include disks and half-disks embedded inside bigger half-disks encodes the left-module structure of $A$ on $B$.

Given an $E_n$-algebra $A$ we know that $E_n$-center $\fZ_n(A)$ has the structure of an $E_{n+1}$ algebra.
Moreover, the pair $(\fZ_{n} (A), A)$ can be given the structure of an algebra over the $(n+1)$-dimensional Swiss cheese operad. 
In fact, $(\fZ_{n} (A), A)$ is the {\em universal} such pair.
This universality is a conjecture of \cite{Kontsevich} which was later made precise and proved in \cite{Thomas, Tamarkin, Dolgushev, jnkf others?}. 
One consequence of this \brian{universal property}

Abstractly, an algebra over the $(n+1)$-dimensional Swiss cheese operad can be modeled as a {\em constructible} factorization algebra on the upper half space $\HH^{n+1}$. 
Concretely, this is the data of a pair $(\bB, \bM)$ where $\bB$ is a locally constant factorization algebra on the ``bulk" manifold $\RR^n \times \RR_{>0}$ and $\bM$ is a locally constant factorization algebra on the boundary $\RR^n \times \{0\}$.

\begin{prp}[\cite{Lurie, AF}]
For any smooth manifold $M$ and Lie algebra $\fg$ there exists a constructible factorization algebra on $M \times \RR_{\geq 0}$ which is a model for the algebra $(\fZ_n(\fg), \UU_n(\fg))$ over the $(n+1)$-dimensional Swiss cheese operad.
\end{prp}

%We have developed locally constant factorization models separately for enveloping $E_n$-algebras and their centers.
%Combining these descriptions we obtain the following.
%
%\begin{prp}
%For any smooth manifold $M$ and Lie algebra $\fg$ the pair $(\bZ_n(\fg), \bU_n (\fg))$ define a constructible factorization algebra on the $(n+1)$-manifold with boundary $M \times \RR_{\geq 0}$.
%When $M = \RR^n$, this is a model for the algebra $(\fZ_n(\fg), \UU_n(\fg))$ over the $(n+1)$-dimensional Swiss cheese operad.
%\end{prp}
%
%\begin{proof}[Proof sketch]
%In the bulk manifold $M \times \RR_{>0}$ we place the 
%\end{proof}

\subsection{How factorization homology intertwines with taking the center}

A natural question in our setting is what happens to our pair $(\bZ_n(\fg), \bU_n \fg)$ when we take factorization homology.
As we will see below, the behavior is optimal.

Let us start with a discussion of the general situation.
Let $(A,B)$ be a Swiss cheese pair: $A$ is an $E_1$ algebra in $E_n$ algebras and $B$ is an $E_n$ algebra in left $A$-modules. 
We will freely view these as locally constant factorization algebras on framed $n$-manifolds.
Observe that since factorization homology is a symmetric monoidal functor, 
it is immediate that $\int_S B$ is a left module over $\int_S A$.
Indeed, for any $(n-k)$-dimensional framed manifold $S$, 
taking factorization homology $\int_S B$ yields a locally constant factorization algebra on $\RR^k$ 
and this factorization structure is compatible with the left action of $\int_S A$ as a locally constant factorization algebra on $\RR^k$.
The universal property of the center implies there is then a canonical map
\[
\int_{S} A \to \fZ_k \left( \int_S B \right).
\]
In particular, when $A = \fZ(B)$, we have
\begin{equation}
\label{eqn: can cen int}
\int_{S} \fZ(B) \to \fZ_k \left( \int_S B \right),
\end{equation}
so that taking centers intertwines with taking factorization homology.
In our favorite case, this relationship is as nice as possible.

\begin{prp}
\label{prp: z commutes with int}
For any $L_\infty$ algebra $\fg$ and any closed $(n-k)$-dimensional manifold $S$,
the canonical map of $E_k$-algebras
\[
\int_{S} \fZ_n(\fg) \to \fZ_k \left( \int_S \UU_n \fg \right)
\]
is a weak equivalence.
\end{prp}

As a slogan, we say ``factorization homology commutes with taking centers,'' 
at least for enveloping $E_n$ algebras.
It is natural to ask whether this result holds in general.

\begin{qtn}
Is the canonical map \eqref{eqn: can cen int} a weak equivalence when $\UU_n \fg$ is replaced by an arbitrary $E_n$-algebra?
\end{qtn}

\owen{We should see if that's what Tamarkin-Tsygan prove for  $E_1$ algebras, as it would be further evidence.}

\begin{proof}[Proof of Proposition~\ref{prp: z commutes with int}]
The key fact is a simple consequence of the K\"unneth theorem in the setting of de Rham forms.
Let $S$ be the closed $n-k$-dimensional manifold of the proposition,
and let $V$ be an arbitrary manifold without boundary.
Then there is a canonical map
\[
\Omega^*(V) \otimes \Omega^*(S) \to \Omega^*(V \times S),
\]
by wedge product after pulling back along the two projection maps.
It is a quasi-isomorphism, by K\"unneth.
Similarly, the canonical map
\[
\Omega_c^*(V) \otimes \Omega^*(S) \to \Omega_c^*(V \times S),
\]
is a quasi-isomorphism, as $S$ is compact.

Let $\fg_S$ denote the $L_\infty$ algebra $\Omega^*(S) \otimes \fg$. 
Then these quasi-isomorphisms above imply there are quasi-isomorphisms of $L_\infty$ algebras
\begin{align*}
\Omega^*(V) \otimes \fg_S &\xto{\simeq} \Omega^*(V \times S) \otimes \fg \\
\Omega_c^*(V) \otimes \fg_S &\xto{\simeq} \Omega_c^*(V \times S) \otimes \fg 
\end{align*}
and hence a quasi-isomorphism
\[
\bU_k \fg_S \xto{\simeq} \int_S \bU_n \fg
\]
of factorization algebras.

Likewise, on each open set $V \subset \RR^k$, 
we obtain a quasi-isomorphism
\[
\bZ_k(\fg_S)(V) \cong \clies( \Omega^*(V) \otimes \fg_S, \bU_k \fg_S) \xto{\simeq} \clies(\Omega^*(V \times S) \otimes \fg, \bU_n(V \times S))
\]
and this map is functorial in opens.
The righthand side is, however, the pushforward $\int_S \bZ_n \fg$.
\owen{Hmmm, that map goes the wrong way, but I'm pretty sure it provides the inverse-up-to-qiso we need.}
\end{proof}

\owen{Then ask what is the factorization homology on a compact manifold with boundary, which leads into next section.}

\section{Universal bulk TFT}
\label{sec: TFT}
%
%Given an $E_{n+1}$-algebra one can speak of its $\infty$-category of left (or right) modules.
%This is obtained by ``forgetting" the $E_{n+1}$-algebra to an $E_1$-algebra then considering the left-modules for this $E_1$-algebra.
%
%The $E_n$-center, or $E_n$-Hochschild cohomology, of an $E_n$-algebra $A$ is the {\em universal} $E_{n+1}$-algebra which acts on $A$. 
%In Section \ref{sec:swiss} below, we will recall an elegant operadic interpretation of this universal picture and interpret it in terms of {\em constructible factorization algebras}. 
%In the case of $E_n$-enveloping algebras, we will provide a strict factorization model of this universal situation in terms of a constructible factorization algebra on an $(n+1)$-dimensional 
%manifold with boundary. 
%
%We will furthermore provide an interpretation of this constructible factorization algebra in terms of the quantization of a certain topological field theory. 
%The key insight is that there is a {\em classical limit} of the $E_n$-center $\fZ_n(\fg)$ which is equivalent to the observables of an $(n+1)$-dimensional topological field theory known as {\em BF theory}. 
%Likewise, there is a classical limit of $\UU_n(\fg)$ which can be viewed as a boundary condition for BF theory.
%
%In this sense, topological BF theory is the universal $(n+1)$-dimensional field theory which has the $E_n$-enveloping algebra as a boundary condition. 
%This partially confirms the terminology used in \cite{ButsonYoo}  of topological BF theory as the ``universal bulk theory" of $\UU_n(\fg)$. 

In this section, we turn to an interpretation of the $E_n$-center of an $E_n$-enveloping algebra in terms of a certain topological field theory (TFT).

\owen{Somewhere please mention that the slogan ``quantization commutes with pushforward'' holds for this class of theories.}

Abstractly, we know that any algebra over the Swiss cheese operad can be modeled as a constructible factorization algebra on a manifold with boundary. 
One drawback of the previous section is that we did not provide a model for the $E_n$-center of an enveloping algebra as a constructible factorization algebra on an $(n+1)$-dimensional manifold with boundary. 
There is, however, a certain ``dequantization" of the $E_n$-center that we do have an explicit description of. 

The key insight is that there exists a filtration on our model for the $E_n$-center $\bZ_n(\fg)$ and the $E_n$-enveloping algebra $\bU_n (\fg)$ whose associated graded factorization algebras ${\rm Gr} \; \bZ_n(\fg)$ and ${\rm Gr} \; \bU_n(\fg)$ are {\em commutative} factorization algebras. 

Our first main result is the following. 

%Generally speaking, the local observables of a topological field theory on a manifold $M$ define a locally constant factorization algebra on $M$. 

\begin{prp}
Let $M$ be a smooth $n$-dimensional manifold and $\fg$ a Lie algebra. 
There is a constructible $\PP_0$-factorization algebra 
\begin{equation}\label{eqn:graded}
\left(\Tilde{\bZ}_n (\fg) \; , \; {\rm Gr} \; \bU_n(\fg) \right)
\end{equation}
on $M \times \RR_{\geq 0}$ such that $\pi_* \Tilde{\bZ}_n (\fg)$ is equivalent to ${\rm Gr} \; \bZ_n(\fg)$ as commutative factorization algebras on $M$ where $\pi : M \times \RR_{\geq 0} \to M$ is the projection. 
\end{prp}

A $\PP_0$, or $1$-shifted Poisson, algebra is a commutative dg algebra equipped with a bracket of cohomological degree $+1$ that satisfies a graded version of the Jacobi identity and is a biderivation with respect to the commutative product \brian{reference}. 
Likewise, a $\PP_0$-factorization algebra is a factorization algebra whose value on each open set is $\PP_0$-algebra. 

The Batalin--Vilkovisky (BV) formalism for studying quantum field theory \brian{finish}

Following the proof of this proposition, our main thrust is to interpret this result in the BV formalism by exhibiting a topological field theory on the $(n+1)$-dimensional manifold with boundary $M \times \RR_{\geq 0}$ whose factorization algebra of classical observables is precisely the constructible factorization algebra in (\ref{eqn:graded}). 

\brian{as a corollary butson-yoo}


%\begin{thm}
%Let $M$ be a smooth $n$-manifold and $\fg$ a Lie algebra. 
%There is a constructible factorization algebra on $M \times [0,1)$ satisfying the following properties:
%\begin{itemize}
%\item[(1)] On the $n$-dimensional stratum $M \times \{0\}$ the factorization algebra is equivalent to $\bU_n(\fg)$.
%\item[(2)] On the $(n+1)$-dimensional stratum $M \times (0,1)$, the factorization algebra is a quantization of the observables of topological BF theory based on the Lie algebra $\fg$.
%\item[(3)] Locally on $\RR^n \times [0,1)$ this factorization algebra produces \brian{deligne picture how to say}
%\end{itemize}
%\end{thm}

%Let $\fg$ be a dg Lie algebra and consider the $E_n$ algebra $\UU_n \fg$. 
%We have shown that a model for the $E_n$-center ${\frak Z}_n (\UU_n \fg) = {\frak Z}_n ({\rm id}_{\UU_n \fg})$ is the $n$-dimensional locally constant factorization algebra 
%\[
%\clie \left( \fg \otimes \Omega \; , \; \clieu (\fg \otimes \Omega_c) \right)  .
%\]


\subsection{The bulk factorization algebra}

Let $M$ be an $n$-dimensional manifold and $\fg$ a Lie algebra. 

\begin{dfn}
For an open set $U \subset M \times \RR_{>0}$ let $\Tilde{\bZ}_n(\fg) (U)$ be the cochain complex 
\[
\Tilde{\bZ}_n(\fg) (U) = \clie \bigg(\fg \otimes \Omega (U) \; , \; \Sym \left(\fg \otimes \Omega_c(U) [2] \right) \bigg) .
\]
The assignment $\Tilde{\bZ}_n(\fg) (U)$ defines a locally constant factorization algebra on $M \times \RR_{>0}$. 
\end{dfn}

On each open set $U$, the cochain complex $\Tilde{\bZ}_n(\fg) (U)$ is actually a commutative dg algebra. 
In fact, it has the structure of a $\PP_0$-algebra where the $1$-shifted bracket $\{\cdot, \cdot\}$ is defined as follows.

\begin{prp}
$\Tilde{\bZ}_n(\fg)$ has the structure of a $\PP_0$-factorization algebra on $M \times \RR_{>0}$. 
\end{prp}
\begin{proof}
Note that as an underlying graded vector space $\Tilde{\bZ}_n(\fg) (U)$ is of the form
\[
{\rm Sym} \left(\fg^* \otimes \Bar{\Omega}_c (U) [n-1] \right) \; \Hat{\otimes} \; {\rm Sym}  \left(\fg \otimes \Omega_c(U) [2] \right)  .
\]
Let $x^* \otimes \alpha$ denote an element of $\fg \otimes \Bar{\Omega}_c (U)$ and $y \otimes \beta$ denote an element of $\fg \otimes \Omega_c(U) [2]$. 
Then, the bracket involving the linear elements $(x^* \otimes \alpha) \otimes 1$ and $1 \otimes (y \otimes \beta)$ is defined by
\begin{align*}
\{(x^* \otimes \alpha) \otimes 1 , 1 \otimes (y \otimes \beta)\} & = \<x^*, y\>_\fg \int_U \alpha \beta \\
\{(x^* \otimes \alpha) \otimes 1 , (x'^* \otimes \alpha') \otimes 1\} & = 0 \\
\{1 \otimes (y \otimes \beta) , 1 \otimes (y' \otimes \beta')\} & = 0 . 
\end{align*}
Here, $\<x^*, y\>_\fg$ denotes the linear pairing between $\fg$ and $\fg^*$ and $\int_U\alpha \beta$ denotes the linear pairing between compactly supported distributional differential forms and differential forms. 
The bracket is extended to the entire symmetric algebra by using the graded Leibniz rule.
\end{proof}

\subsection{The ``classical limit"}

For any dg Lie (in fact, $L_\infty$) algebra, the Chevalley--Eilenberg cochain complex computing Lie algebra homology admits a natural filtration whose associated graded has the structure of a commutative dg algebra.
If $\fh$ is a dg Lie algebra, let $\clieu_{\leq k} (\fh)$ be the subcomplex of Chevalley--Eilenberg chains which is $\Sym^{\leq k} (\fh[1])$ as an underlying graded vector space. 
The associated graded is the free symmetric algebra on $\fh[1]$ thought of as simply a cochain complex:
\[
{\rm Gr} \; \clieu (\fh) = {\rm Sym} (\fh [1])  .
\]
Here, the differential on the right-hand side is simply the underlying linear differential of $\fh$ (in terms of $L_\infty$ algebras, this is the $1$-ary operation $\ell_1$). 

The Lie bracket on $\fh$ endows ${\rm Sym} (\fh [1])$ with the additional structure of a $\PP_0$-algebra. 
On linear elements this is simply the Lie bracket on $\fh$, and one extends to the full symmetric algebra by the graded Leibniz rule.

Consider our factorization model for the $E_n$-enveloping algebra $\bU_n(\fg) = \clieu (\fg \otimes \Omega_c)$. 
The filtration on Chevalley--Eilenberg chains equips $\bU_n(\fg)$ with a filtration as a factorization algebra. 
Furthermore, the resulting associated graded ${\rm Gr} \; \bU_n (\fg)$ has the natural structure of a $\PP_0$-factorization algebra.

There is a similar filtration on our model for the $E_n$-center $\bZ_n(\fg)$. 
Define
\[
F^k \bZ_n(\fg) = \clie \bigg(\fg \otimes \Omega \; , \; \clieu_{\leq k} (\fg \otimes \Omega_c) \bigg) .
\]
It is immediate to check that this is a filtration of factorization algebras and that its associated graded has the structure of a $\PP_0$-factorization algebra.
In fact, we have the following result, which explains the relationship to the ``bulk" $(n+1)$-dimensional factorization algebra $\Tilde{\bZ}_n(\fg)$ we introduced in the last section.

 \begin{lmm}
Let $M$ be an $n$-dimensional manifold.
There is a quasi-isomorphism of  $\PP_0$-factorization algebras on $M$:
\[
\pi_* \Tilde{\bZ}_n(\fg) \; \xto{\simeq} \; {\rm Gr} \; \bZ_n(\fg) .
\]
where $\pi : M \times \RR_{>0} \to M$ is the projection. 
\end{lmm}

In fact, we will show that this quasi-isomorphism is a deformation retraction. 

\begin{proof}
To exhibit this quasi-isomorphism, we introduce the following cochain maps.
For an open set $U \subset M$ let
\[
\int_\RR : \Omega_c(U \times \RR) \to \Omega_c (U) [1] 
\] 
be the map which integrates a compactly supported form on $U \times \RR$ along $\RR$. 
This map is a quasi-isomorphism for any $U $ and admits the following explicit retract. 
Let $\phi$ be a fixed compactly supported function on $\RR$ of mass $1$ and define
\[
r_\phi : \Omega_c(U) [1] \to \Omega_c (U \times \RR)
\]
by $r_\phi (\alpha) = \alpha \wedge \phi \, \d t$. 
\end{proof}

Since the universal action of $\bZ_n(\fg)$ on $\bU_n (\fg)$ is compatible with the above filtrations, we obtain the following constructible factorization algebra on $M \times \RR_{\geq 0}$. 

\begin{dfn}\label{dfn:constructible1}
Let $(\Tilde{\bZ}_n (\fg), {\rm Gr} \bU_n(\fg))$ be the following constructible $\PP_0$-factorization algebra on $M \times \RR_{\geq 0}$:
\begin{itemize}
\item to an open set $U \subset M \times \RR_{> 0}$, we assign the cochain complex $\Tilde{\bZ}_n (\fg)(U)$.
\item to an open set $U \subset M \times \RR_{\geq 0}$ with $U \cap (M \times \{0\}) \ne 0$ we assign the cochain complex ${\rm Gr} \;\bU_n(\fg)(U)$. 
\end{itemize}
\brian{not sure how much to say about structure maps}
\end{dfn}


\subsection{Bulk-boundary topological field theory}

It is the central theme of \cite{CG1, CG2} that the observables of a perturbative quantum field theory define the structure of a factorization algebra. 
In this setup, one first uses the Batalin--Vilkovisky (BV) formalism to define a perturbative classical field theory. 
The key ingredient in this formalism is a $(-1)$-shifted symplectic structure on the classical space of fields. 
The observables, or functions on the classical space of fields is then equipped with the structure of a $\PP_0$-factorization algebra.

More recently in \cite{ButsonYoo} and \cite{Eugene}, it is shown how to run the classical BV formalism on manifolds with boundary. 
Let $N$ be such a manifold with boundary and let $\cE$ denote the space of fields, typically given as the space of sections of a finite rank vector bundle on $N$. 
The definition of a classical BV theory on $N$ amounts to prescribing the following data:
\begin{itemize}
\item[(1)]
an ordinary classical BV theory on the interior $N \setminus \partial N$ whose space of fields is $\cE|_{N \setminus \partial N}$;
\item[(2)] 
a compatible $0$-shifted symplectic structure on $\cE|_{\partial N}$ equipped with a Lagrangian subspace $\cL \subset \cE|_{\partial N}$.
This is called a {\em boundary condition}.
\end{itemize}
From this data at the level of fields, one obtains a constructible $\PP_0$-factorization algebra on the manifold with boundary $N$ at the level of the observables. 

For any Lie algebra $\fg$, there is a topological field theory defined in any dimension known as ``topological BF theory". 
Suppose $N$ is an $(n+1)$-dimensional manifold, which for now we assume has no boundary $\partial N = \emptyset$. 
In the BV formalism, the perturbative space of fields of BF theory on $N$ consists of
\[
(A, B) \in \Omega^{\bu} (N) \otimes \fg [1] \oplus \Omega^{\bu} (N) \otimes \fg^* [n-1] .
\]
When $N$ is compact, the classical moduli space underlying this field theory has an elegant description in terms of the AKSZ formalism. 
It can be interpreted as the following mapping stack 
\begin{equation} \label{stack1}
{\rm Map}(N_{\rm dR} ,  {\rm T}^*[n] {\rm B} G)
\end{equation}
where $N_{\rm dR}$ denotes the de Rham stack of $N$ and where $G$ is a Lie group whose Lie algebra is $\fg$. 
Perturbative BF theory is obtained by taking the tangent space of the above mapping stack near at the trivial $G$-bundle.
Concretely, the classical moduli space consists of pairs $(A, B)$ where $A \in \Omega^1 (N) \otimes \fg$ and $B \in \Omega^{n-1} (N) \otimes \fg^*$ satisfying the equations
\begin{align*}
\d A + \frac12 [A,A] & = 0 \\
\d_A B + [A,B] & = 0 .
\end{align*}

Now, suppose $N$ has a boundary $\partial N \ne 0$.
Then, (\ref{stack1}) no longer admits a $(-1)$-shifted symplectic structure. 
However, the AKSZ construction equips 
\[
{\rm Map}(\partial N , {\rm T}^* [n] {\rm B} G)
\]
with a $0$-shifted symplectic structure. 
Perturbatively, this mapping stack represents the restriction of the fields to the boundary. 

For BF theory, there is a natural choice of a Lagrangian for this boundary condition. 
In terms of mapping stacks, it is given by considering maps from $N_{\rm dR}$ into the $n$-shifted conormal bundle of ${\rm B} G$:
\[
{\rm Map}(N_{\rm dR} , {\rm N}^*_e [n] {\rm B}G) .
\]
Then, by abstract maneuvers \brian{reference} the following fiber product
\[
\begin{tikzcd}
X \ar[r] \ar[d] & {\rm Map} (N , {\rm T}^* [n] {\rm B} G) \ar[d] \\
{\rm Map}(\partial N_{\rm dR} , {\rm N}^*_e  [n] {\rm B}G) \ar[r] & {\rm Map}(\partial N_{\rm dR} , {\rm T}^*[n]  {\rm B}G)
\end{tikzcd}
\]
is equipped with a $(-1)$-shifted symplectic structure. 
Heuristically, the classical observables are given by functions on the $(-1)$-shifted symplectic space $X$.

Perturbatively, we follow \cite{ButsonYoo} and \cite{Eugene} to make the following definition within the BV formalism.

\begin{dfn}
Let $M$ be an $n$-dimensional manifold.
{\em Topological BF theory with its universal Neumann boundary condition} is the classical bulk-boundary theory on $M \times \RR_{\geq 0}$ described as follows:
\begin{itemize}
\item[(1)] 
The bulk theory is that of topological BF theory on $M \times \RR_{>0}$, where the space of fields is 
\[
\cE|_{M \times \RR_{>0}} = \Omega^{\bu} (M \times \RR_{>0}) \otimes \fg [1] \oplus \Omega^{\bu} (M \times \RR_{>0}) \otimes \fg^* [n-2] .
\]
\item[(2)] 
The boundary condition is determined by the subspace of the fields on the boundary
\[
\Omega^{\bu} (M) \otimes \fg^* [n-2] \subset \cE|_{M \times \{0\}} .
\]
\end{itemize}
\end{dfn}

We obtain the following by a direct unpacking of the setup in \cite{Eugene}. 

\begin{prp}
The constructible $\PP_0$-factorization algebra of topological BF theory with its universal Neumann boundary condition is equivalent to the constructible factorization algebra $(\Tilde{\bZ}_n (\fg), {\rm Gr} \bU_n (\fg))$ of Definition \ref{dfn:constructible1}. 
\end{prp}
%\subsection{The bulk TFT}
%
%Let us place the locally constant factorization algebra model of the $E_n$-enveloping algebra $\bU_n (\fg) = \clieu(\fg \otimes \Omega_c)$ on the $n$-manifold $M$.
%This factorization algebra is equivalent to the pushforward of a factorization algebra $\Obs_{\rm BF}$ on the $(n+1)$-dimensional manifold $M \times \RR$ along the projection $\pi : M \times (0,1) \to M$ which we proceed to construct. 
%
%\begin{dfn}
%For an open set $V \subset M \times (0,1)$ let $\Obs^{\rm cl}_{\rm BF} (V)$ be the cochain complex 
%\[
%\Obs^{\rm cl}_{\rm BF} (V) = \clie \bigg(\fg \otimes \Omega (V) \; , \; \Sym \left(\fg \otimes \Omega_c(V) [2] \right) \bigg) .
%\]
%The assignment $V \mapsto \Obs^{\rm cl}_{\rm BF}(V)$ defines a locally constant factorization algebra on $M \times (0,1)$. 
%\end{dfn}
%
%We note that $\Obs_{\rm BF}^{\rm cl}$ is a factorization algebra with values in commutative dg algebras. 
%In fact, it is given by the ``classical observables" of a topological field theory on $M \times (0,1)$ known as ``topological BF theory". 
%
%We now consider the pushforward factorization algebra $\pi_* \Obs^{\rm cl}_{\rm BF}$ on $M$.
%Locally, on disks, we will see that it is quasi-isomorphic to a certain limit, or ``dequantization", of our model for the $E_n$-center of $\UU_n \fg$.
%Recall, this model is given by the factorization algebra on $M$:
%\begin{equation}\label{eqn:centerTFT}
%\bZ_n(\fg) = \clie\left(\fg \otimes \Omega \, , \, \clieu (\fg \otimes \Omega_c) \right) .
%\end{equation}
%
%The ``dequantization" is defined using the following filtration of this model.
%For any Lie algebra $\fh$, let $\clieu_{\leq k} (\fh)$ be the subcomplex of Chevalley--Eilenberg chains which is $\Sym^{\leq k} (\fh[1])$ as an underlying graded vector space. 
%
%\begin{dfn}
%Introduce the filtration on the factorization algebra on $M$ in (\ref{eqn:centerTFT}) by 
%\[
%F^k \bZ_n(\fg) = \clie \bigg(\fg \otimes \Omega \; , \; \clieu_{\leq k} (\fg \otimes \Omega_c) \bigg) .
%\]
%\end{dfn}
%
%This is a filtration of factorization algebras on $M$. 
%The associated graded factorization algebra is
%\[
%{\rm Gr} \; \bZ_n(\fg) \; = \; \clie \bigg(\fg \otimes \Omega \; , \; \Sym \left(\fg \otimes \Omega_c [1] \right) \bigg) .
%\]
%Notice this is similar to the model $E_n$-center except we have turned off the Chevalley--Eilenberg differential on chains. 
%
% \begin{lmm}
%There is a quasi-isomorphism of commutative factorization algebras on $M$:
%\[
%\pi_* \Obs^{\rm cl}_{\rm BF} \; \xto{\simeq} \; {\rm Gr} \; \bZ_n(\fg) .
%\]
%\end{lmm}
%
%In fact, we will show that this quasi-isomorphism is a deformation retraction. 
%
%\begin{proof}
%To exhibit this quasi-isomorphism, we introduce the following cochain maps.
%For an open set $U \subset M$ let
%\[
%\int_\RR : \Omega_c(U \times \RR) \to \Omega_c (U) [1] 
%\] 
%be the map which integrates a compactly supported form on $U \times \RR$ along $\RR$. 
%This map is a quasi-isomorphism for any $U $ and admits the following explicit retract. 
%Let $\phi$ be a fixed compactly supported function on $\RR$ of mass $1$ and define
%\[
%r_\phi : \Omega_c(U) [1] \to \Omega_c (U \times \RR)
%\]
%by $r_\phi (\alpha) = \alpha \wedge \phi \, \d t$. 
%\end{proof}

%\begin{lmm}
%Consider the locally constant factorization algebra $\cF_{\rm bulk}$ on $M \times \RR$ which assigns to an open set $U \subset M \times \RR$
%\[
%\cF_{\rm bulk} = \clie \left(\fg \otimes \Omega (U) \; , \; \clieu (\fg \otimes \Omega_c (U)[1]) \right) .
%\]
%Then, 
%\end{lmm}
%
%\begin{proof}
%For $V \subset M$, the integration of compactly supported de Rham forms along $\RR$ 
%\[
%\fg \otimes \Omega_c (\pi^{-1} (V)) = \fg \otimes \Omega_c (V \times \RR) \xto{\int_{\RR}} \fg \otimes \Omega_c (V) [-1] .
%\]
%is a quasi-isomorphism. 
%
%\end{proof}

\section{Examples?}


\greg{Add the Koszul duality example. Add examples coming from topological spaces and abelian Lie algebras}

\subsection{$E_n$-calculus}
\bibliographystyle{alpha}  
\bibliography{centralize}

%\bibliographystyle{spmpsci}  

\end{document}
We call $\ev_f$ the 
$g: Sym(\fg \otimes \Omega (U_J) [1]) \longrightarrow B(U_J) $
let $f\otimes X  $ be an 
element in $\cliels\big(\fg \otimes \Omega^* , B\big) \otimes \cliels\big(\fg \otimes \Omega_c^* \big)$.  
Let 


, since  



Recall that we have a factorization algebra map~\eqref{eq:DefofFonFaclevel}  $\mathbf{f}: \cliels(\fg \otimes \Omega_c^* \to B$.
The unital factorization algebra is given, for any open $U$, by $k(U)=k$.


which gives us,  for any integer $n$, maps 
\begin{multline}
 Sym^n\big(\fg \otimes \Omega^*_c(U)[1]\big) \otimes Sym^p \big( \fg \otimes \Omega^* (U)[-1] ,B(U)\big) \\
 \stackrel{\Delta \otimes id}\longrightarrow 
 \bigoplus_{q} Sym^{n-q}\big(\fg \otimes \Omega^*_c(U)[1]\big) \otimes  Sym^q\big(\fg \otimes \Omega^*_c(U)[1]\big) 
 \otimes Sym^p \big( \fg \otimes \Omega^* (U)[-1] , B(U)\big)
 \\ 
 \stackrel{\id \otimes ev}\longrightarrow Sym^{n-p}\big(\fg \otimes \Omega^*_c(U)\big) \otimes B(U)  \hookrightarrow
 \cliels\big(\fg \otimes \Omega_c^*(U), B(U) \big) 
\end{multline}



\def \Fac {\mathrm{Fac}}
We now need to express the $E_n$-structure on ${\rm Mor}_{\LMod_{\int_{S^{n-1}} \UU_n\fg}}(\UU_n \fg, B_f)$ induced by the equivalence of Proposition~\ref{P:ModentoModSn}, and then on the subsequent isomorphic hom spaces of modules morphisms.  Since we are going to take advantage of the factorization algebra presentation of $\UU_n( \fg)$, see~Theorem~\ref{T:UnofLie}, we recall the following factorization algebra description of the centralizer.
Let $\cA \stackrel{f}\to \cB$ be a morphism of locally constant factorization algebras on $\RR^n$ corresponding to an $E_n$-algebra map similarly denoted. Then by Theorems~\ref{T:En=Fac}, \ref{T:centralizer=inthom} the centralizer of $f$ is represented by the locally constant factorization algebra  
${\rm Mor}_{\Fac_{\cA}}(\cA, \cB_f)$ which is the internal mapping object  of maps from $\cA$ to $\cB_f$ in the $\infty$-category of locally constant factorization algebras on $\RR^n$ which are a $\cA$-module. 

The factorization algebra structure is 
represented as follows, see~\cite{GTZ3}: let $\cU =\big((U_i)_{i=1\dots r}, V\big)$ be a collection pairwise disjoint open convex subdisks $U_i$ of a disk $V$ and $(\phi_i: \cA\to \cB_f)_{i=1\dots r}$ be $\cA$-module maps of factorization algebras. 
To this data we need to associate a factorization algebra map 
$$\rho_{\cU}^{(\phi_i)} : \cA \longrightarrow \cB .$$
First since $V$ is a disk, the structure maps $\cA(V) \to \cA(\RR^n)$ and $\cB(V)\to \cB(\RR^n)$ are equivalences so that it is sufficient to define $\rho_{\cU}^{(\phi_i)}$ on the restrictions $\cA_{V}$, $\cB_{V}$ of the factorization algebras to $V$ or equivalently to treat only the case where $V =\RR^n$  which we assume now.
Then $\rho_{\cU}^{(\phi_i)}$ is given by a chain complex map $\cA(W)\to \cB_f(W)$ for any open $W \subset \RR^n$.  
Now we use the fact that the data of $\cU$ gives us a natural way of computing $\cA(W)$, $\cB_f (W)$ using the Cech complex $\check{C}(-,\cW)$ of a factorization algebra with values in a factorizing cover. Namely, we have canonical equivalences 
$$\check{C}(\cA, W_\cU) \stackrel{\simeq}\to \cA(W), \qquad  \check{C}(\cB_f, W_\cU) \stackrel{\simeq}\to \cB_f(W)$$ 
where $\W_{\cU}$ is the cover of $W$ given by $W_1=W\cap U_1, \dots, W_r=W\cap U_r, W^c$ where $W^c$ is the intersection of $W$ with an open $U^c$ that contains the complement of the $U_i$'s but not any of the $U_i$. Note that by definition of a factorization algebra, $\check{C}(\cA, W_\cU)$ is  a direct sum of tensors of the form 
$\cA(W'_1) \otimes \cdots \cA(W_r') \otimes \cA((W')^c) $ where $W'_i$ are subsets of $U_i$, $(W')^c$ is a subset $U^c$. 

Then the map $
\cA(W) \stackrel{\rho_{\cU}^{(\phi_i)}(W)}\longrightarrow \cB_f(W)$ is uniqueley determined by the commutative diagram 
\begin{equation}\label{eq:Cechassociatedtoconfofdisks}
\xymatrix{\cA(W) \ar[rr]^{\rho_{\cU}^{(\phi_i)}(W)}&& \cB_f(W) \\
\check{C}(\cA, W_\cU) \ar[u]_{\simeq}   \ar[rr]_{\check{\rho}_{\cU}^{(\phi_i)}}&& \check{C}(\cB_f, W_\cU) \ar[u]^{\simeq} } 
\end{equation}
where the lower map $\check{\rho}_{\cU}^{(\phi_i)}$ is given by $\phi_i(W'_i): \cA(W'_i) \to \cB_f(W'_i)$ on $W_i'$ and by $id: \cA((W')^c) \to \cA((W')^c)=\cB_f((W')^c)$ on $(W')^c$. Note that the fact that the $\phi_i$ are precisely $\cA$-module maps where the module structure of $\cB_f$ is induced by $f$ induced that $\rho_{\cU}^{(\phi_i)}$ is indepedent of the choice of $U^c$. Indeed, by definition of a map of $\cA$-modules in factorization algebras, we have that such a map computed on the complement of a compact set containing the isobarycenter of its domain  in $\RR^n$ is given by the identity evaluate on $\cA$ of this complement.  Further, for the same reason we have
\begin{lmm} \label{L:reductiontodisks}
 Let $\xymatrix{ \cB \ar[r]^{g} \ar[d]^{h} & \cB' \ar[d]_{h'} \\ \cC \ar[r]^{g'} & \cC'}$ be a diagramm in the $\infty$-category of $\cA$-modules. If the restriction 
 $$\xymatrix{ \cB_{\coprod U_i} \ar[r] \ar[d] & \cB'_{\coprod U_i} \ar[d] \\ 
 \cC_{\coprod U_i} \ar[r] & \cC'_{\coprod U_i}}$$ of this diagram  to the union $\coprod U_i$   is commutative then so is the original diagram.
\end{lmm}
\begin{proof}
 Using the diagramm~\eqref{eq:Cechassociatedtoconfofdisks}, it is equivalent to prove that the following diagram 
 \xymatrix{ \check{C}(\cB, _\cU)\ar[r] \ar[d] & \check{C}(\cB', _\cU) \ar[d] \\ \check{C}(\cC, _\cU\ar[r] & \check{C}(\cC', _\cU}
 is commutative. But the map $\check{C}(\cB, _\cU) \to \check{C}(\cB', _\cU)$ 
 is induced by the direct sums of tensors products of chain maps $ g(W_i): \cB(U_i)= \cB_{U_i}(W_i) \to \cB'_{U_i} (W_i)$ on each $i=1\dots r$ and 
 by $id: \cB(W^c) \to \cB'(W^c)$.
\end{proof}


We now apply this to the special case of $\UU_n(\fg)$, that is for $\cA= \cliels(\Omega^*_c \otimes \fg)$ as we have seen. 
\begin{lmm}
 There is a commutative diagram 
 \[ \xymatrix{ \Sym( \fg[1-n])^{\otimes r} \ar[r]^{\simeq}& \bigotimes_{i=1}^r\cliels(\Omega^*_c(U_i) \otimes \fg) \ar[d]^{\rho} \ar[r]^{\bigotimes \phi_i(U_i)}  & \cB_f(U_1)\otimes \cdots \otimes B_f(U_r) \ar[d]^{\rho} \\ 
\Sym( \fg[1-n]) \ar[u]^{\delta^{r}} \ar[r]^{\simeq} & \cliels(\Omega^*_c(V) \otimes \fg) \ar[r]_{\rho_{\cU}^{(\phi_i)}(V)}& \cB_f(V)  } \] where $\delta^r$ is the iterated cocommuative coproduct. 
\end{lmm}
\begin{proof}
 The commtativity of the right square follows from~\eqref{eq:Cechassociatedtoconfofdisks}. For the left square, note that the factorization algebra structure maps on $\cliels(\Omega^*_c \otimes \fg)$ 
 are induced by applying the Chevalley-Eilenberg chain functor to the canonical maps of cosheaves of Lie algebras $\bigoplus_{i=1}^{r} (\Omega^*_c(U_i)\otimes \fg) \cong \Omega^*_c(\coprod U_i) \otimes \fg \longrightarrow  \Omega^*_c(V)\otimes \fg $. 
\end{proof}
